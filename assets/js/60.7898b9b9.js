(window.webpackJsonp=window.webpackJsonp||[]).push([[60],{427:function(s,a,t){"use strict";t.r(a);var e=t(11),n=Object(e.a)({},(function(){var s=this,a=s.$createElement,t=s._self._c||a;return t("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[t("h1",{attrs:{id:"使用一键脚本部署"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#使用一键脚本部署"}},[s._v("#")]),s._v(" 使用一键脚本部署")]),s._v(" "),t("p",[s._v("GitHub: "),t("a",{attrs:{href:"https://github.com/summerblue/laravel-ubuntu-init",target:"_blank",rel:"noopener noreferrer"}},[s._v("https://github.com/summerblue/laravel-ubun..."),t("OutboundLink")],1)]),s._v(" "),t("p",[s._v("适用于 Ubuntu 16.04 的 LNMP 安装脚本，并设置了国内镜像加速。")]),s._v(" "),t("p",[s._v("请确保所有命令都以 root 账户执行，如果登录账户不是 root，则需要执行 "),t("code",[s._v("sudo -H -s")]),s._v(" 切换为 root 账户后再下载安装。")]),s._v(" "),t("div",{staticClass:"language- extra-class"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[s._v("Welcome to Alibaba Cloud Elastic Compute Service !\n\nLast login: Tue Aug 13 13:17:16 2019 from 221.218.153.139\nroot@iZwn1owkika3a8Z:~# wget -qO- https://raw.githubusercontent.com/summerblue/laravel-ubuntu-init/master/download.sh - | bash\n===> 开始下载...\n===> 下载完毕\n\n安装脚本位于： /root/laravel-ubuntu-init\n===> 正在初始化系统...    [DONE]\n===> 正在初始化软件源...    [DONE]\n===> 正在安装基础软件...    [DONE]\n===> 正在安装 PHP...    [DONE]\n===> 正在安装 Mysql / Nginx / Redis / Memcached / Beanstalkd / Sqlite3...    [DONE]\n===> 正在安装 Nodejs / Yarn...    [DONE]\n===> 正在安装 Composer...    [DONE]\n安装完毕\nMysql root 密码：ORAdqR7QwG1aHNk3jaGCpOWBu7owgVvf\n请手动执行 source ~/.bash_aliases 使 alias 指令生效。\nroot@iZwn1owkika3a8Z:~# \n")])])]),t("p",[s._v("出现以上输出，说明安装成功。注意保存密码，切勿丢失。随后请执行：")]),s._v(" "),t("div",{staticClass:"language-bash extra-class"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[s._v("$ "),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("source")]),s._v(" ~/.bash_aliases\n")])])]),t("h3",{attrs:{id:"配置运行环境"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#配置运行环境"}},[s._v("#")]),s._v(" 配置运行环境")]),s._v(" "),t("p",[s._v("首先，我们需要增加 Nginx 站点：")]),s._v(" "),t("div",{staticClass:"language-bash extra-class"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[s._v("$ ~/laravel-ubuntu-init/16.04/nginx_add_site.sh\n")])])]),t("p",[s._v("根据提示，输入一些信息并回车：")]),s._v(" "),t("div",{staticClass:"language-php extra-class"},[t("pre",{pre:!0,attrs:{class:"language-php"}},[t("code",[s._v("请输入项目名：deployment\n请输入站点域名（多个域名用空格隔开）：laravel"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("deployment"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("wi1dcard"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("cn\n")])])]),t("p",[s._v("请注意，站点名称（项目名）仅允许英文、数字、"),t("code",[s._v("-")]),s._v(" 和 "),t("code",[s._v("_")]),s._v(" 组合。另外，与上文宝塔面板类似，站点域名也可以使用公网 IP 代替。")]),s._v(" "),t("p",[s._v("请注意以下输出：")]),s._v(" "),t("div",{staticClass:"language-php extra-class"},[t("pre",{pre:!0,attrs:{class:"language-php"}},[t("code",[s._v("域名列表：laravel"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("deployment"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("wi1dcard"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("cn\n项目名：deployment\n项目目录："),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("var")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("www"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("deployment\n是否确认？ "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("y"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),t("span",{pre:!0,attrs:{class:"token constant"}},[s._v("N")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n")])])]),t("p",[s._v("记住此处的项目目录，后续将会使用。检查无误后，输入 "),t("code",[s._v("y")]),s._v(" 并回车。")]),s._v(" "),t("p",[s._v("没什么问题的话，将会看到成功提示：")]),s._v(" "),t("div",{staticClass:"language-php extra-class"},[t("pre",{pre:!0,attrs:{class:"language-php"}},[t("code",[s._v("配置文件创建成功\nNginx 重启成功\n")])])]),t("h3",{attrs:{id:"修改linux的配置文件"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#修改linux的配置文件"}},[s._v("#")]),s._v(" 修改linux的配置文件")]),s._v(" "),t("p",[s._v("/etc/nginx/sites-available/<站点名>.conf")]),s._v(" "),t("h1",{attrs:{id:"手动部署"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#手动部署"}},[s._v("#")]),s._v(" 手动部署")]),s._v(" "),t("h2",{attrs:{id:"初始化系统"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#初始化系统"}},[s._v("#")]),s._v(" 初始化系统")]),s._v(" "),t("p",[s._v("全新的 Ubuntu Bionic 18.04 LTS 服务器")]),s._v(" "),t("h3",{attrs:{id:"切换root用户"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#切换root用户"}},[s._v("#")]),s._v(" 切换root用户")]),s._v(" "),t("div",{staticClass:"language- extra-class"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[s._v("$ sudo -i\n")])])]),t("h3",{attrs:{id:"更新软件源"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#更新软件源"}},[s._v("#")]),s._v(" 更新软件源")]),s._v(" "),t("p",[s._v("登录到服务器，我们首先要做的就是更新软件源：")]),s._v(" "),t("div",{staticClass:"language-bash extra-class"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[s._v("$ "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("apt")]),s._v(" update\n")])])]),t("blockquote",[t("p",[s._v("注意：这里所说的「更新软件源」并非升级软件，在中文内更加准确的描述应当是 "),t("strong",[s._v("刷新软件源")]),s._v("。在这个过程中，包管理器（也就是 APT，可以理解为「软件管家」之类）将会从 "),t("strong",[s._v("软件源")]),s._v(" 服务器上获取一份最新的包列表并建立本地缓存，包括软件名称、描述、最新版本、下载地址等等。")])]),s._v(" "),t("p",[s._v("你将会看到类似这样的输出：")]),s._v(" "),t("div",{staticClass:"language-php extra-class"},[t("pre",{pre:!0,attrs:{class:"language-php"}},[t("code",[s._v("Get"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v(" http"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("//mirrors.cloud.aliyuncs.com/ubuntu xenial InRelease [247 kB]")]),s._v("\nGet"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),s._v(" http"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("//mirrors.cloud.aliyuncs.com/ubuntu xenial-updates InRelease [109 kB]")]),s._v("\nGet"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("3")]),s._v(" http"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("//mirrors.cloud.aliyuncs.com/ubuntu xenial-security InRelease [109 kB]")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("\n")])])]),t("p",[s._v("稍等片刻即可刷新完毕，最后有可能提示：")]),s._v(" "),t("div",{staticClass:"language-php extra-class"},[t("pre",{pre:!0,attrs:{class:"language-php"}},[t("code",[t("span",{pre:!0,attrs:{class:"token number"}},[s._v("186")]),s._v(" packages can be upgraded"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v(" Run "),t("span",{pre:!0,attrs:{class:"token single-quoted-string string"}},[s._v("'apt list --upgradable'")]),s._v(" to see them"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("\n")])])]),t("p",[s._v("意为有 186 个软件包可升级，执行 "),t("code",[s._v("apt list --upgradable")]),s._v(" 命令来查看它们。")]),s._v(" "),t("p",[s._v("我们暂且忽略，直接升级：")]),s._v(" "),t("div",{staticClass:"language-php extra-class"},[t("pre",{pre:!0,attrs:{class:"language-php"}},[t("code",[s._v("$ apt upgrade\n")])])]),t("blockquote",[t("p",[s._v("注意：生产环境下，更新任何软件包前都需要仔细检查，确保更新日志内没有影响现有环境的改动。另外，你也可以先不升级，对后续部署基本没有影响。")])]),s._v(" "),t("p",[s._v("你将会看到一大坨（是的，一坨）输出，它们是将被升级的软件列表；注意关注最后几行：")]),s._v(" "),t("div",{staticClass:"language-php extra-class"},[t("pre",{pre:!0,attrs:{class:"language-php"}},[t("code",[t("span",{pre:!0,attrs:{class:"token number"}},[s._v("186")]),s._v(" upgraded"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("8")]),s._v(" newly installed"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v(" to remove "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("and")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v(" not upgraded"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("\nNeed to get "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("249")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token constant"}},[s._v("MB")]),s._v(" of archives"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("\nAfter this operation"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("331")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token constant"}},[s._v("MB")]),s._v(" of additional disk space will be used"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("Do")]),s._v(" you want to "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("continue")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("?")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),t("span",{pre:!0,attrs:{class:"token constant"}},[s._v("Y")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n")])])]),t("p",[s._v("意为此操作将占用 331 MB 磁盘空间。此时输入 "),t("code",[s._v("Y")]),s._v("（注意关闭中文输入法），或直接回车即可开始升级。主流云服务厂商均有缓存软件源，数据流量是通过内网传输，所以该过程不会太慢。")]),s._v(" "),t("h3",{attrs:{id:"本地化配置"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#本地化配置"}},[s._v("#")]),s._v(" 本地化配置")]),s._v(" "),t("p",[s._v("所谓「本地化配置」，可理解为系统时区、单位、地址、语言等配置的统称。使其能够符合某一地区的习惯。虽然我们的母语是中文，但还是建议将服务器配置为英语，尽可能避免奇葩乱码等问题带来的影响。")]),s._v(" "),t("p",[s._v("首先，执行以下命令生成美国本地化数据：")]),s._v(" "),t("div",{staticClass:"language-bash extra-class"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[s._v("$ locale-gen en_US.UTF-8\n")])])]),t("p",[s._v("随后将本地化配置修改为 "),t("code",[s._v("en_US.UTF-8")]),s._v(" 即可：")]),s._v(" "),t("div",{staticClass:"language-bash extra-class"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[s._v("$ update-locale "),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[t("span",{pre:!0,attrs:{class:"token environment constant"}},[s._v("LC_ALL")])]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("en_US.UTF-8\n")])])]),t("p",[s._v("如果服务器在国外，则服务商可能不会将其配置为东八区；我们还需手动修改时区为 "),t("code",[s._v("Asia/Shanghai")]),s._v("：")]),s._v(" "),t("div",{staticClass:"language-bash extra-class"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[s._v("timedatectl set-timezone Asia/Shanghai\n")])])]),t("p",[s._v("若你是在国内云服务商租用的服务器，那么极有可能时区已经配置好了。")]),s._v(" "),t("p",[s._v("至此，系统初始化阶段完成。")]),s._v(" "),t("h2",{attrs:{id:"安装-nginx"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#安装-nginx"}},[s._v("#")]),s._v(" 安装 Nginx")]),s._v(" "),t("p",[s._v("由于我们执行 "),t("code",[s._v("apt update")]),s._v(" 更新软件源不久，所以直接安装 Nginx 即可：")]),s._v(" "),t("div",{staticClass:"language-bash extra-class"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[s._v("$ "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("apt")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("install")]),s._v(" nginx\n")])])]),t("p",[s._v("再次收到确认提示：")]),s._v(" "),t("div",{staticClass:"language-php extra-class"},[t("pre",{pre:!0,attrs:{class:"language-php"}},[t("code",[t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v(" upgraded"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("10")]),s._v(" newly installed"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v(" to remove "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("and")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v(" not upgraded"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("\nNeed to get "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("715")]),s._v(" kB of archives"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("\nAfter this operation"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("8")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("752")]),s._v(" kB of additional disk space will be used"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("Do")]),s._v(" you want to "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("continue")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("?")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),t("span",{pre:!0,attrs:{class:"token constant"}},[s._v("Y")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n")])])]),t("p",[s._v("上节为大家介绍过输入 "),t("code",[s._v("Y")]),s._v(" 或直接回车均可继续，也就是说此处的询问默认结果为 "),t("code",[s._v("Y")]),s._v("。有个普遍共识是，在提供选项供用户选择时，以大写项为默认值。例如此处的 "),t("code",[s._v("[Y/n]")]),s._v(" 那么 "),t("code",[s._v("Y")]),s._v(" 即为默认值；同理，若是 "),t("code",[s._v("[a/b/c/D/e]")]),s._v("，那么 "),t("code",[s._v("D")]),s._v(" 即为默认值。")]),s._v(" "),t("p",[s._v("另外，上节介绍了更新软件源即为包管理器从软件源服务器拉取软件包列表并建立本地缓存。其实，当我们执行 "),t("code",[s._v("apt install")]),s._v(" 操作时，包管理器便会从本地缓存中找到该软件包的指定版本，并进行下载、安装。")]),s._v(" "),t("p",[s._v("稍等几秒钟即可安装成功：")]),s._v(" "),t("p",[t("img",{attrs:{src:"https://raw.githubusercontent.com/wi1dcard/laravel-deployment/master/src/images/74389aa7e78e0030794cc74a3f20da1d.png",alt:"img"}})]),s._v(" "),t("h3",{attrs:{id:"管理-nginx-服务"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#管理-nginx-服务"}},[s._v("#")]),s._v(" 管理 Nginx 服务")]),s._v(" "),t("p",[s._v("我们可使用 "),t("code",[s._v("service")]),s._v(" 命令管理服务状态，常用操作如下：")]),s._v(" "),t("div",{staticClass:"language-bash extra-class"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[s._v("$ "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("service")]),s._v(" nginx start "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 启动 Nginx")]),s._v("\n$ "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("service")]),s._v(" nginx stop "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 停止 Nginx")]),s._v("\n$ "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("service")]),s._v(" nginx restart "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 重启 Nginx")]),s._v("\n")])])]),t("p",[s._v("同时，可使用 "),t("code",[s._v("systemctl")]),s._v(" 命令开关服务的开机自启：")]),s._v(" "),t("div",{staticClass:"language-bash extra-class"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[s._v("$ systemctl "),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("enable")]),s._v(" nginx "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 启用 Nginx 开机启动")]),s._v("\n$ systemctl disable nginx "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 禁用 Nginx 开机启动")]),s._v("\n")])])]),t("blockquote",[t("p",[s._v("注意：通常情况下，在 APT 安装后已默认启用 Nginx 开机启动。")])]),s._v(" "),t("h3",{attrs:{id:"确认-nginx-正常运行"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#确认-nginx-正常运行"}},[s._v("#")]),s._v(" 确认 Nginx 正常运行")]),s._v(" "),t("p",[s._v("与一键脚本类似，在浏览器内输入服务器公网 IP（或域名）并打开，出现默认欢迎页面说明 Nginx 已经正常运行：")]),s._v(" "),t("p",[t("img",{attrs:{src:"https://raw.githubusercontent.com/wi1dcard/laravel-deployment/master/src/images/305376a54fe7b7f8a2103abbf18b1943.png",alt:"img"}})]),s._v(" "),t("p",[s._v("恭喜，Nginx 安装成功。")]),s._v(" "),t("h2",{attrs:{id:"安装-php"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#安装-php"}},[s._v("#")]),s._v(" 安装 PHP")]),s._v(" "),t("h3",{attrs:{id:"配置第三方软件源"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#配置第三方软件源"}},[s._v("#")]),s._v(" 配置第三方软件源")]),s._v(" "),t("p",[s._v("由于 Ubuntu 的官方软件源通常不包含最新版本的 PHP，因此需要添加一个包含最新 PHP 的第三方软件源。")]),s._v(" "),t("p",[s._v("在添加之前，我们首先安装名为 "),t("code",[s._v("software-properties-common")]),s._v(" 的软件包，它提供了快速管理软件源的实用脚本：")]),s._v(" "),t("div",{staticClass:"language-bash extra-class"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[s._v("$ "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("apt")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("install")]),s._v(" -y software-properties-common\n")])])]),t("p",[s._v("相比之前执行的 "),t("code",[s._v("apt install")]),s._v(" 命令，这次我添加了 "),t("code",[s._v("-y")]),s._v(" 选项，表示当 APT 遇到询问时默认确认，避免再次输入 "),t("code",[s._v("Y")]),s._v(" 并回车。")]),s._v(" "),t("p",[s._v("随后，执行以下脚本添加第三方 PHP 软件源：")]),s._v(" "),t("div",{staticClass:"language-bash extra-class"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[s._v("$ add-apt-repository -y ppa:ondrej/php\n")])])]),t("p",[s._v("成功后别忘记刷新：")]),s._v(" "),t("div",{staticClass:"language-bash extra-class"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[s._v("$ "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("apt-get")]),s._v(" update\n")])])]),t("h3",{attrs:{id:"安装-php-2"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#安装-php-2"}},[s._v("#")]),s._v(" 安装 PHP")]),s._v(" "),t("p",[s._v("PHP 的安装实际上分为三个软件包：")]),s._v(" "),t("ul",[t("li",[s._v("PHP - PHP 自身。")]),s._v(" "),t("li",[s._v("PHP-CLI - PHP 的命令行接口，通俗地说，在命令行内执行 "),t("code",[s._v("php")]),s._v(" 便依赖于此包。")]),s._v(" "),t("li",[s._v("PHP-FPM - 全称为 "),t("code",[s._v("PHP FastCGI Process Manager")]),s._v("，用于管理 PHP 进程，并提供 FastCGI 接口与 Nginx 交互；浏览网页时的请求便是由 Nginx 交由 PHP-FPM 处理的。")])]),s._v(" "),t("p",[t("code",[s._v("apt install")]),s._v(" 支持多参数，所以我们不必执行多次安装，只需在单条命令内写明多个软件包即可：")]),s._v(" "),t("div",{staticClass:"language-bash extra-class"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[s._v("$ "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("apt")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("install")]),s._v(" -y php7.2 php7.2-cli php7.2-fpm\n")])])]),t("p",[s._v("按照 "),t("a",{attrs:{href:"https://learnku.com/docs/laravel/5.8/installation#installation",target:"_blank",rel:"noopener noreferrer"}},[s._v("Laravel 5.8 安装文档"),t("OutboundLink")],1),s._v(" 的说明，接着安装几个必备的 PHP 扩展：")]),s._v(" "),t("div",{staticClass:"language-bash extra-class"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[s._v("$ "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("apt")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("install")]),s._v(" -y php7.2-mbstring php7.2-xml php7.2-bcmath\n")])])]),t("blockquote",[t("p",[s._v("注意：由于 PDO 等扩展已经内置在 PHP 中，故无需额外安装。")])]),s._v(" "),t("p",[s._v("对于不同项目的不同依赖，可能有必要安装以下扩展，根据实际情况选择即可：")]),s._v(" "),t("div",{staticClass:"language-bash extra-class"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[s._v("$ "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("apt")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("install")]),s._v(" php7.2-curl php7.2-gd php7.2-mysql php7.2-opcache php7.2-zip php7.2-sqlite3\n")])])]),t("p",[s._v("有个小技巧是，你可以通过 "),t("code",[s._v("apt-cache")]),s._v(" 命令来搜索当前软件源内的包：")]),s._v(" "),t("div",{staticClass:"language-bash extra-class"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[s._v("$ "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("apt-cache")]),s._v(" search php7.2\n")])])]),t("p",[s._v("例如以上命令，将会得到所有名称、描述等信息内包含 "),t("code",[s._v("php7.2")]),s._v(" 字样的软件包：")]),s._v(" "),t("div",{staticClass:"language-php extra-class"},[t("pre",{pre:!0,attrs:{class:"language-php"}},[t("code",[s._v("php"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("amqp "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token constant"}},[s._v("AMQP")]),s._v(" extension "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("for")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token constant"}},[s._v("PHP")]),s._v("\nphp"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("apcu "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token constant"}},[s._v("APC")]),s._v(" User Cache "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("for")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token constant"}},[s._v("PHP")]),s._v("\nphp"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("geoip "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v(" GeoIP module "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("for")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token constant"}},[s._v("PHP")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("\n")])])]),t("h3",{attrs:{id:"管理-php-fpm-服务"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#管理-php-fpm-服务"}},[s._v("#")]),s._v(" 管理 PHP-FPM 服务")]),s._v(" "),t("p",[s._v("与管理 Nginx 服务类似，你同样可以通过 "),t("code",[s._v("service")]),s._v(" 和 "),t("code",[s._v("systemctl")]),s._v(" 命令管理 PHP-FPM 服务：")]),s._v(" "),t("div",{staticClass:"language-bash extra-class"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[s._v("$ "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("service")]),s._v(" php7.2-fpm restart"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 重启 PHP-FPM")]),s._v("\n$ "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("service")]),s._v(" php7.2-fpm start "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 启动 PHP-FPM")]),s._v("\n$ "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("service")]),s._v(" php7.2-fpm stop "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 停止 PHP-FPM")]),s._v("\n$ systemctl "),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("enable")]),s._v(" php7.2-fpm "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 启用 PHP-FPM 开机启动")]),s._v("\n$ systemctl disable php7.2-fpm "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 禁用 PHP-FPM 开机启动")]),s._v("\n")])])]),t("blockquote",[t("p",[s._v("注意：不同版本的 PHP-FPM 服务名是不一致的。例如 7.2 为 "),t("code",[s._v("php7.2-fpm")]),s._v("，7.3 为 "),t("code",[s._v("php7.3-fpm")]),s._v("，以此类推……")])]),s._v(" "),t("h3",{attrs:{id:"确认-php-fpm-正常运行"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#确认-php-fpm-正常运行"}},[s._v("#")]),s._v(" 确认 PHP-FPM 正常运行")]),s._v(" "),t("p",[s._v("通过以下命令可确认 PHP-FPM 进程正在运行：")]),s._v(" "),t("div",{staticClass:"language-bash extra-class"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[s._v("$ "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("ps")]),s._v(" aux "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("grep")]),s._v(" php\n")])])]),t("p",[s._v("其中：")]),s._v(" "),t("ul",[t("li",[t("code",[s._v("ps aux")]),s._v(" 用于列出系统当前正在运行的所有进程的所有信息。")]),s._v(" "),t("li",[t("code",[s._v("|")]),s._v(" 名为管道操作符，将前一条命令的标准输出连接到下一条命令的标准输入。")]),s._v(" "),t("li",[t("code",[s._v("grep")]),s._v(" 是一款文本搜索工具，常用来过滤命令行输出；"),t("code",[s._v("php")]),s._v(" 是搜索的关键词。")])]),s._v(" "),t("p",[t("code",[s._v("ps")]),s._v(" 将进程信息输出到 "),t("code",[s._v("grep")]),s._v(" 进行过滤，后者筛选出包含 "),t("code",[s._v("php")]),s._v(" 字样的行，再将它们输出。于是，它们相结合，产生的效果便是这样：")]),s._v(" "),t("div",{staticClass:"language-php extra-class"},[t("pre",{pre:!0,attrs:{class:"language-php"}},[t("code",[s._v("root      "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("6546")]),s._v("  "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.0")]),s._v("  "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("3.8")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("315484")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("19340")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("?")]),s._v("        Ss   "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("14")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("13")]),s._v("   "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("00")]),s._v(" php"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("fpm"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" master process "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("etc"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("php"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("7.2")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("fpm"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("php"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("fpm"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("conf"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\nwww"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("data  "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("6550")]),s._v("  "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.0")]),s._v("  "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1.0")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("315484")]),s._v("  "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("5260")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("?")]),s._v("        "),t("span",{pre:!0,attrs:{class:"token constant"}},[s._v("S")]),s._v("    "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("14")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("13")]),s._v("   "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("00")]),s._v(" php"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("fpm"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" pool www\nwww"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("data  "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("6551")]),s._v("  "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.0")]),s._v("  "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1.0")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("315484")]),s._v("  "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("5260")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("?")]),s._v("        "),t("span",{pre:!0,attrs:{class:"token constant"}},[s._v("S")]),s._v("    "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("14")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("13")]),s._v("   "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("00")]),s._v(" php"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("fpm"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" pool www\nroot      "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("6566")]),s._v("  "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.0")]),s._v("  "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.1")]),s._v("  "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("15964")]),s._v("   "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("920")]),s._v(" pts"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("    "),t("span",{pre:!0,attrs:{class:"token constant"}},[s._v("S")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("+")]),s._v("   "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("14")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("13")]),s._v("   "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("00")]),s._v(" grep "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("--")]),s._v("color"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("auto php\n")])])]),t("p",[s._v("忽略最后一行（这是我们正在执行的 "),t("code",[s._v("grep")]),s._v(" 命令），可观察到有 "),t("code",[s._v("php-fpm")]),s._v(" 进程正在运行中。")]),s._v(" "),t("p",[s._v("若 PHP-FPM 进程不存在，那么输出将只有孤零零的 "),t("code",[s._v("grep")]),s._v("：")]),s._v(" "),t("div",{staticClass:"language-php extra-class"},[t("pre",{pre:!0,attrs:{class:"language-php"}},[t("code",[s._v("root      "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("6722")]),s._v("  "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.0")]),s._v("  "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.1")]),s._v("  "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("15964")]),s._v("   "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("920")]),s._v(" pts"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("    "),t("span",{pre:!0,attrs:{class:"token constant"}},[s._v("S")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("+")]),s._v("   "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("14")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("24")]),s._v("   "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("00")]),s._v(" grep "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("--")]),s._v("color"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("auto php\n")])])]),t("blockquote",[t("p",[s._v("提示：你可以结合上文提到的 "),t("code",[s._v("service")]),s._v(" 命令，将服务进程手动停止试试看；测试完毕不要忘记再次启动。")])]),s._v(" "),t("h2",{attrs:{id:"安装-git-和-composer"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#安装-git-和-composer"}},[s._v("#")]),s._v(" 安装 Git 和 Composer")]),s._v(" "),t("p",[s._v("Git 和 Composer 是部署 PHP 项目时必不可少的两款工具。用它们代替原有 SCP 方案有许多好处：")]),s._v(" "),t("ul",[t("li",[s._v("安全")]),s._v(" "),t("li",[s._v("快速")]),s._v(" "),t("li",[s._v("可回滚")]),s._v(" "),t("li",[s._v("易管理")]),s._v(" "),t("li",[s._v("...")])]),s._v(" "),t("p",[s._v("好处非常非常多。实际上，正如之前提到的「在生产环境中这样做很危险」，直接使用 SCP 或压缩包传输代码是万万不可取的，具体原因请见文末。")]),s._v(" "),t("h3",{attrs:{id:"安装-git"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#安装-git"}},[s._v("#")]),s._v(" 安装 Git")]),s._v(" "),t("p",[s._v("依然使用 APT 安装：")]),s._v(" "),t("div",{staticClass:"language-bash extra-class"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[s._v("$ "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("apt")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("install")]),s._v(" -y "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("git")]),s._v("\n")])])]),t("h3",{attrs:{id:"安装-composer"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#安装-composer"}},[s._v("#")]),s._v(" 安装 Composer")]),s._v(" "),t("p",[s._v("Composer 比较特殊，不能通过 APT 安装。虽然网络上流传着一大堆从第三方服务器直接下载 "),t("code",[s._v("composer.phar")]),s._v(" 文件的安装方式，但根据 Composer 的官方文档，正确的安装姿势应当为：")]),s._v(" "),t("div",{staticClass:"language-bash extra-class"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[s._v("$ "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("wget")]),s._v(" https://raw.githubusercontent.com/composer/getcomposer.org/master/web/installer -O - -q "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" php -- --filename"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("composer --install-dir"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("/usr/local/bin\n")])])]),t("blockquote",[t("p",[s._v("以上修改自 "),t("a",{attrs:{href:"https://getcomposer.org/doc/faqs/how-to-install-composer-programmatically.md",target:"_blank",rel:"noopener noreferrer"}},[s._v("https://getcomposer.org/doc/faqs/how-to-in..."),t("OutboundLink")],1),s._v("，另一种比较复杂的安装方式可参考 https://getcomposer.org/download/。你可以不必关心该脚本的具体意义，通常它只需执行一次。")]),s._v(" "),t("p",[s._v("注意：通过第三方服务器、直接下载 "),t("code",[s._v("composer.phar")]),s._v(" 不进行任何检查，均无法保证 Composer 正常运行，且存在安全风险！请务必遵循官方文档内的说明。")])]),s._v(" "),t("p",[s._v("稍等片刻，将会出现以下输出：")]),s._v(" "),t("div",{staticClass:"language-php extra-class"},[t("pre",{pre:!0,attrs:{class:"language-php"}},[t("code",[s._v("All settings correct "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("for")]),s._v(" using Composer\nDownloading"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("\n")])])]),t("p",[s._v("提示当前环境检查通过，可正常使用 Composer；随后开始下载。")]),s._v(" "),t("p",[s._v("鉴于众所周知的原因，大陆访问国际网络速度奇慢无比，请耐心等待。当出现以下提示时，表示已经安装成功：")]),s._v(" "),t("div",{staticClass:"language-php extra-class"},[t("pre",{pre:!0,attrs:{class:"language-php"}},[t("code",[s._v("Composer "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("version "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1.8")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v(".4")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" successfully installed to"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("usr"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("local"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("bin"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("composer\n"),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("Use")]),s._v(" it"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" php "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("usr"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("local"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("bin"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("composer\n")])])]),t("p",[s._v("按照提示，我们可以使用 "),t("code",[s._v("/usr/local/bin/composer")]),s._v(" 运行 Composer，当然，还有个更简单的方法：")]),s._v(" "),t("div",{staticClass:"language-bash extra-class"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[s._v("$ composer\n")])])]),t("p",[s._v("你可能会收到这样一条警告：")]),s._v(" "),t("div",{staticClass:"language-bash extra-class"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[s._v("Do not run Composer as root/super user"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("!")]),s._v(" See https://getcomposer.org/root "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("for")]),s._v(" details\n")])])]),t("p",[s._v("意为请勿使用根用户运行 Composer；暂时不必关心它，我将在后续课程中详细说明。")]),s._v(" "),t("h3",{attrs:{id:"配置-packagist-中国镜像"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#配置-packagist-中国镜像"}},[s._v("#")]),s._v(" 配置 Packagist 中国镜像")]),s._v(" "),t("p",[s._v("这一步是可选的。如果你的服务器位于大陆，强烈建议使用可信赖的代理，或是国内 Packagist 镜像。")]),s._v(" "),t("p",[s._v("推荐使用 Laravel-China 提供的 "),t("a",{attrs:{href:"https://packagist.laravel-china.org/",target:"_blank",rel:"noopener noreferrer"}},[s._v("Packagist 中国镜像"),t("OutboundLink")],1),s._v("，执行以下命令即可切换服务器内 Composer 的默认 Packagist 源：")]),s._v(" "),t("div",{staticClass:"language-bash extra-class"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[s._v("$ composer config -g repo.packagist composer https://mirrors.aliyun.com/composer/\n")])])]),t("h3",{attrs:{id:"拓展-为什么生产环境中万万不可使用-scp-传输代码"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#拓展-为什么生产环境中万万不可使用-scp-传输代码"}},[s._v("#")]),s._v(" 拓展：为什么生产环境中万万不可使用 SCP 传输代码？")]),s._v(" "),t("p",[s._v("更准确地说，这个问题应该是："),t("strong",[s._v("为什么不可使用 SCP 将整个 Laravel 应用传输到服务器的 Nginx 站点目录？")]),s._v("。")]),s._v(" "),t("p",[t("strong",[s._v("SCP 传输文件")]),s._v(" 这一操作本身不存在任何问题；不过，本地开发时 "),t("code",[s._v("APP_DEBUG")]),s._v("（调试模式）通常为打开状态，并且 "),t("code",[s._v("APP_KEY")]),s._v("（应用密钥）已经生成为一个固定值，若是利用 SCP 将整个目录传输到服务器并直接公开，那么 "),t("code",[s._v(".env")]),s._v("文件内的值也会照搬到服务器内。")]),s._v(" "),t("p",[s._v("调试模式时展示的详细错误信息虽然有利于排查问题，但在生产环境开启极易引发安全漏洞；至于应用密钥，Laravel 将使用它加密 Cookie 等信息，在本地和线上绝对不应当使用相同值，更严格地说，线上的 "),t("code",[s._v("APP_KEY")]),s._v(" 必须完全随机并确保不被任何人获得。")]),s._v(" "),t("p",[s._v("虽然你可以上传后再修改它们的值，或是使用类似 Rsync 等支持忽略特定文件的方式。但其一，不方便、易受人为失误影响；其二，无法享受 Git + Composer 的大量优势。")]),s._v(" "),t("p",[s._v("综上所述，在实际部署过程中，"),t("strong",[s._v("绝对不推荐使用 SCP 传输代码")]),s._v("。")]),s._v(" "),t("h2",{attrs:{id:"安装-mysql"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#安装-mysql"}},[s._v("#")]),s._v(" 安装 MySQL")]),s._v(" "),t("h3",{attrs:{id:"安装-mysql-5-7"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#安装-mysql-5-7"}},[s._v("#")]),s._v(" 安装 MySQL 5.7")]),s._v(" "),t("div",{staticClass:"language-shell extra-class"},[t("pre",{pre:!0,attrs:{class:"language-shell"}},[t("code",[s._v("$ "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("sudo")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("apt")]),s._v(" update "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 更新源")]),s._v("\n$ "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("sudo")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("apt-get")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("install")]),s._v(" -y mysql-server mysql-client "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 安装 MySQL 服务端及客户端")]),s._v("\n$ "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("sudo")]),s._v(" mysql_secure_installation "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 设置。在这里可以设置 root 密码、删除测试数据库、禁止远程访问（即只能本地访问或者 via SSH：通过 SSH 访问）等等。")]),s._v("\n")])])]),t("h3",{attrs:{id:"安装-mysql-8-0"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#安装-mysql-8-0"}},[s._v("#")]),s._v(" 安装 MySQL 8.0")]),s._v(" "),t("div",{staticClass:"language-shell extra-class"},[t("pre",{pre:!0,attrs:{class:"language-shell"}},[t("code",[s._v("$ "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("wget")]),s._v("  -c  https://repo.mysql.com/mysql-apt-config_0.8.13-1_all.deb "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 下载 MySQL 8.0 的 deb 包")]),s._v("\n$ "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("sudo")]),s._v(" dpkg  -i  mysql-apt-config_0.8.10-1_all.deb "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 安装 deb 包")]),s._v("\n$ "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("sudo")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("apt")]),s._v(" update\n$ "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("sudo")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("apt-get")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("install")]),s._v(" -y mysql-server mysql-client\n$ "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("sudo")]),s._v(" mysql_secure_installation\n")])])]),t("h3",{attrs:{id:"进行数据库设置"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#进行数据库设置"}},[s._v("#")]),s._v(" 进行数据库设置")]),s._v(" "),t("div",{staticClass:"language- extra-class"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[s._v("root@VM-0-3-ubuntu:~# mysql_secure_installation\n\nSecuring the MySQL server deployment.\n\nConnecting to MySQL using a blank password.\n\nVALIDATE PASSWORD PLUGIN can be used to test passwords\nand improve security. It checks the strength of password\nand allows the users to set only those passwords which are\nsecure enough. Would you like to setup VALIDATE PASSWORD plugin?\n\nPress y|Y for Yes, any other key for No: \n")])])]),t("p",[s._v("是否使用VALIDATE PASSWORD插件，来检查用户设置的密码强度？我们输入 "),t("code",[s._v("y")])]),s._v(" "),t("div",{staticClass:"language- extra-class"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[s._v("There are three levels of password validation policy:\n\nLOW    Length >= 8    //弱强度\nMEDIUM Length >= 8, numeric, mixed case, and special characters //\nSTRONG Length >= 8, numeric, mixed case, special characters and dictionary     //高强度             file\n\nPlease enter 0 = LOW, 1 = MEDIUM and 2 = STRONG: \n")])])]),t("p",[s._v("系统为我们提供了三个密码验证策略供我们选择，我们这里选择高强度 "),t("code",[s._v("2")])]),s._v(" "),t("div",{staticClass:"language- extra-class"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[s._v("Please set the password for root here.\n\nNew password: \n")])])]),t("p",[s._v("输入 大小写字母 + 数字 + 字符的密码，输入完毕回车即可")]),s._v(" "),t("div",{staticClass:"language- extra-class"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[s._v("Estimated strength of the password: 100 \nDo you wish to continue with the password provided?(Press y|Y for Yes, any other key for No) : \n")])])]),t("p",[s._v("密码强度： 100 ，询问我们是否使用密码，继续设置。   我们输入"),t("code",[s._v("y")])]),s._v(" "),t("div",{staticClass:"language- extra-class"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[s._v("By default, a MySQL installation has an anonymous user,\nallowing anyone to log into MySQL without having to have\na user account created for them. This is intended only for\ntesting, and to make the installation go a bit smoother.\nYou should remove them before moving into a production\nenvironment.\n\nRemove anonymous users? (Press y|Y for Yes, any other key for No) : \n")])])]),t("p",[s._v("默认情况下，MySQL安装有一个匿名用户，允许任何人登录MySQL而不必拥有为他们创建的用户帐户。 这仅适用于\n测试，并使安装更顺畅。您应该在进入生产之前将其删除环境。 输入"),t("code",[s._v("y")])]),s._v(" "),t("div",{staticClass:"language- extra-class"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[s._v("Normally, root should only be allowed to connect from\n'localhost'. This ensures that someone cannot guess at\nthe root password from the network.\n\nDisallow root login remotely? (Press y|Y for Yes, any other key for No) : \n")])])]),t("p",[s._v("通常，只允许root连接'localhost' 的。 这可以确保有人无法猜测来自网络的root密码。禁止远程登录  输入"),t("code",[s._v("y")])]),s._v(" "),t("div",{staticClass:"language- extra-class"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[s._v("By default, MySQL comes with a database named 'test' that\nanyone can access. This is also intended only for testing,\nand should be removed before moving into a production\nenvironment.\n\n\nRemove test database and access to it? (Press y|Y for Yes, any other key for No) : \n")])])]),t("p",[s._v("默认情况下，MySQL附带一个名为'test'的数据库,任何人都可以访问 这也仅用于测试，并且应该在进入生产之前将其删除\n环境。访问它并删除测试数据库。输入"),t("code",[s._v("y")])]),s._v(" "),t("div",{staticClass:"language- extra-class"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[s._v("Reloading the privilege tables will ensure that all changes\nmade so far will take effect immediately.\n\nReload privilege tables now? (Press y|Y for Yes, any other key for No) : \n")])])]),t("p",[s._v("至此，我们对数据库的配置设置完毕，输入"),t("code",[s._v("y")]),s._v("，立即生效。")]),s._v(" "),t("p",[s._v("安装完数据库后，mysql默认是不允许远程连接。m")]),s._v(" "),t("p",[s._v("mysql默认是只允许本地连接的。所以我们需要修改一个配置文件。然而最新版本的mysql跟以前目录结构不太一样，最新版本的允许远程连接放在/etc/mysql/mysql.conf.d/mysqld.cnf 这个配置文件下，搜索bind-address = 127.0.0.1 这行，把它注释掉，然后是用命令service mysql restart重启mysql服务就可以了。")]),s._v(" "),t("h2",{attrs:{id:"部署应用代码"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#部署应用代码"}},[s._v("#")]),s._v(" 部署应用代码")]),s._v(" "),t("h3",{attrs:{id:"使用-git-拉取项目-https-协议"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#使用-git-拉取项目-https-协议"}},[s._v("#")]),s._v(" 使用 Git 拉取项目（HTTPS 协议）")]),s._v(" "),t("p",[s._v("登录到服务器，执行：")]),s._v(" "),t("div",{staticClass:"language-bash extra-class"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[s._v("$ "),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("cd")]),s._v(" /var/www/\n")])])]),t("p",[t("code",[s._v("cd")]),s._v(" 命令用于切换当前工作目录，"),t("code",[s._v("/var/www")]),s._v(" 是 Nginx 默认的站点存放目录。")]),s._v(" "),t("p",[s._v("随后便可以将仓库克隆到本地了：")]),s._v(" "),t("div",{staticClass:"language-bash extra-class"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[s._v("$ "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("git")]),s._v(" clone https://github.com/wi1dcard/hello-deployment.git deployment\n")])])]),t("blockquote",[t("p",[s._v("提示：若仓库包含大量提交历史，以上命令可能耗时较久；你可以尝试使用 "),t("code",[s._v("--depth")]),s._v(" 选项来优化，详情请搜索 "),t("code",[s._v("Git 浅克隆")]),s._v(" 等关键字。")])]),s._v(" "),t("p",[s._v("请将命令中的 URL 替换为刚刚从 GitHub 或其它仓库托管平台内复制的链接。末尾的 "),t("code",[s._v("deployment")]),s._v(" 参数表示将此仓库克隆至当前工作目录下的 "),t("code",[s._v("deployment")]),s._v(" 子目录内。")]),s._v(" "),t("p",[s._v("稍等将会出现以下输出：")]),s._v(" "),t("div",{staticClass:"language-php extra-class"},[t("pre",{pre:!0,attrs:{class:"language-php"}},[t("code",[s._v("Cloning into "),t("span",{pre:!0,attrs:{class:"token single-quoted-string string"}},[s._v("'hello-deployment'")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("\nremote"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" Enumerating objects"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("130")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" done"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("\nremote"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" Counting objects"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("100")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("%")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("130")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("130")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" done"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("\nremote"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" Compressing objects"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("100")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("%")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("95")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("95")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" done"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("\nremote"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" Total "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("130")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("delta "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("50")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" reused "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("105")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("delta "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("32")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" pack"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("reused "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("\nReceiving objects"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("100")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("%")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("130")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("130")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("2.73")]),s._v(" MiB "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("850.00")]),s._v(" KiB"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("s"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" done"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("\nResolving deltas"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("100")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("%")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("50")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("50")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" done"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("\nChecking connectivity"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v(" done"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("\n")])])]),t("p",[s._v("如果你的项目是「私有」的，那么可能需要输入用户名和密码：")]),s._v(" "),t("div",{staticClass:"language-php extra-class"},[t("pre",{pre:!0,attrs:{class:"language-php"}},[t("code",[s._v("Cloning into "),t("span",{pre:!0,attrs:{class:"token single-quoted-string string"}},[s._v("'hello-deployment'")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("\nUsername "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("for")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token single-quoted-string string"}},[s._v("'https://github.com'")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("输入你的用户名"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("\nPassword "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("for")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token single-quoted-string string"}},[s._v("'https://wi1dcard@github.com'")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("请输入你的密码"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("\n")])])]),t("blockquote",[t("p",[s._v("提示：还记得之前提到的吗？密码输入是不可见的。")])]),s._v(" "),t("h3",{attrs:{id:"使用-composer-安装依赖"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#使用-composer-安装依赖"}},[s._v("#")]),s._v(" 使用 Composer 安装依赖")]),s._v(" "),t("p",[s._v("首先，请切换至 "),t("code",[s._v("deployment")]),s._v(" 目录内：")]),s._v(" "),t("div",{staticClass:"language-bash extra-class"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[s._v("$ "),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("cd")]),s._v(" deployment\n")])])]),t("p",[s._v("接着执行：")]),s._v(" "),t("div",{staticClass:"language-bash extra-class"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[s._v("$ composer "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("install")]),s._v("\n")])])]),t("p",[s._v("稍等片刻，你可能会看到这样的警告：")]),s._v(" "),t("div",{staticClass:"language-bash extra-class"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[s._v("Failed to download foo/bar from dist: The "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("zip")]),s._v(" extension and "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("unzip")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("command")]),s._v(" are both missing, skipping.\nNow trying to download from "),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("source")]),s._v("\n")])])]),t("p",[s._v("意为 PHP Zip 扩展和 "),t("code",[s._v("unzip")]),s._v(" 命令均找不到，此时 Composer 会尝试从依赖的 Git 仓库内直接克隆源码，这是不推荐的；因此我们使用 "),t("code",[s._v("Ctrl + C")]),s._v("（macOS 为 "),t("code",[s._v("Cmd + C")]),s._v("）中止正在运行的命令。")]),s._v(" "),t("p",[s._v("针对该警告信息，可以想到两种解决思路：")]),s._v(" "),t("ul",[t("li",[s._v("使用之前小节提到的 "),t("code",[s._v("apt-cache search")]),s._v(" 搜索 "),t("code",[s._v("php zip")]),s._v(" 关键字，查找 Zip 扩展并安装。")]),s._v(" "),t("li",[s._v("安装 "),t("code",[s._v("unzip")]),s._v(" 命令。")])]),s._v(" "),t("p",[s._v("第一种方法本节不再赘述，我们来尝试第二种方法。首先，尝试手动执行 "),t("code",[s._v("unzip")]),s._v("，确认它的确未安装：")]),s._v(" "),t("div",{staticClass:"language-bash extra-class"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[s._v("$ "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("unzip")]),s._v("\nThe program "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'unzip'")]),s._v(" is currently not installed. You can "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("install")]),s._v(" it by typing:\n"),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("apt")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("install")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("unzip")]),s._v("\n")])])]),t("p",[s._v("看样子在当前系统中确实找不到 "),t("code",[s._v("unzip")]),s._v("。不过，贴心的 APT 帮我们找到了包含 "),t("code",[s._v("unzip")]),s._v(" 的软件包，并直接提供了安装命令：")]),s._v(" "),t("div",{staticClass:"language-bash extra-class"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[s._v("$ "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("apt")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("install")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("unzip")]),s._v("\n")])])]),t("p",[s._v("稍等片刻便安装好了。此时再次执行：")]),s._v(" "),t("div",{staticClass:"language-bash extra-class"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[s._v("$ "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("unzip")]),s._v("\nUnZip "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("6.00")]),s._v(" of "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("20")]),s._v(" April "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("2009")]),s._v(", by Debian. Original by Info-ZIP.\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("..")]),s._v(".\n")])])]),t("p",[s._v("完美。")]),s._v(" "),t("p",[s._v("实际上，不仅是 Composer，其它多数命令都支持使用 "),t("code",[s._v("Ctrl + C")]),s._v(" 中止运行；如果 "),t("code",[s._v("Ctrl + C")]),s._v(" 无效，你也可以试试 "),t("code",[s._v("Ctrl + D")]),s._v("；另外，结合 APT 的提示和 "),t("code",[s._v("apt-cache search")]),s._v("，可以帮助我们很快地解决绝大多数命令缺失的错误，而无需遵从百度来的手动而又复杂的源码编译步骤。")]),s._v(" "),t("p",[s._v("我们回到主题，再次运行 "),t("code",[s._v("composer install")]),s._v("：")]),s._v(" "),t("div",{staticClass:"language-php extra-class"},[t("pre",{pre:!0,attrs:{class:"language-php"}},[t("code",[s._v("Loading composer repositories with package information\nInstalling dependencies "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("including "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("require")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("dev"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" from lock file\nPackage operations"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("72")]),s._v(" installs"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v(" updates"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v(" removals\n  "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v(" Installing dragonmantank"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("cron"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("expression "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("v2"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("2.0")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" Downloading "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("100")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("%")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v(" Installing erusev"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("parsedown "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1.7")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v(".1")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" Downloading "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("100")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("%")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v(" Installing symfony"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("var")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("dumper "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("v4"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("2.3")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" Downloading "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("connecting"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n")])])]),t("p",[s._v("恭喜，等待安装完毕即可。")]),s._v(" "),t("h3",{attrs:{id:"配置环境变量"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#配置环境变量"}},[s._v("#")]),s._v(" 配置环境变量")]),s._v(" "),t("p",[s._v("依赖安装完成后，我们还需要将 "),t("code",[s._v(".env.example")]),s._v(" 文件复制为 "),t("code",[s._v(".env")]),s._v(" 文件，并生成 "),t("code",[s._v("APP_KEY")]),s._v(" 密钥：")]),s._v(" "),t("div",{staticClass:"language-bash extra-class"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[s._v("$ "),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("cd")]),s._v(" /var/www/deployment\n$ php -r "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("\"file_exists('.env') || copy('.env.example', '.env');\"")]),s._v("\n$ php artisan key:generate --ansi\n")])])]),t("blockquote",[t("p",[s._v("提示：实际上，以上两条命令都是从部署应用的 "),t("code",[s._v("composer.json")]),s._v(" - "),t("code",[s._v("scripts")]),s._v(" 小节内摘抄出来的，这也解释了为何使用 "),t("code",[s._v("laravel new")]),s._v(" 创建项目后 "),t("code",[s._v(".env")]),s._v(" 文件就已经存在。有兴趣可深入了解 "),t("a",{attrs:{href:"https://getcomposer.org/doc/articles/scripts.md",target:"_blank",rel:"noopener noreferrer"}},[s._v("Composer Scripts"),t("OutboundLink")],1),s._v("。")])]),s._v(" "),t("h3",{attrs:{id:"配置文件所有者"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#配置文件所有者"}},[s._v("#")]),s._v(" 配置文件所有者")]),s._v(" "),t("p",[s._v("最后，别忘记修改文件所有者：")]),s._v(" "),t("div",{staticClass:"language-bash extra-class"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[s._v("$ "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("chown")]),s._v(" -R www-data:www-data "),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(".")]),s._v("\n")])])]),t("p",[s._v("由于目前所在的工作目录为 "),t("code",[s._v("/var/www/deployment")]),s._v("，所以可用表示当前工作目录的 "),t("code",[s._v(".")]),s._v(" 代替之前的 "),t("code",[s._v("/var/www/deployment")]),s._v("，它们是等效的。")]),s._v(" "),t("p",[s._v("至此，本小节目标完成。你可以通过 "),t("code",[s._v("ll")]),s._v(" 命令来列出当前目录：")]),s._v(" "),t("div",{staticClass:"language-bash extra-class"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[s._v("$ ll\ntotal "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("440")]),s._v("\ndrwxr-xr-x "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("13")]),s._v(" www-data www-data   "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("4096")]),s._v(" Mar  "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("9")]),s._v(" 01:26 ./\ndrwxr-xr-x  "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("5")]),s._v(" root     root       "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("4096")]),s._v(" Mar  "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("9")]),s._v(" 00:49 "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("..")]),s._v("/\ndrwxr-xr-x  "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("6")]),s._v(" www-data www-data   "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("4096")]),s._v(" Mar  "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("9")]),s._v(" 00:45 app/\n-rw-r--r--  "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v(" www-data www-data   "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1686")]),s._v(" Mar  "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("9")]),s._v(" 00:45 artisan\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("..")]),s._v(".\n")])])]),t("h2",{attrs:{id:"配置-nginx-站点信息"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#配置-nginx-站点信息"}},[s._v("#")]),s._v(" 配置 Nginx 站点信息")]),s._v(" "),t("h3",{attrs:{id:"nginx-站点配置"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#nginx-站点配置"}},[s._v("#")]),s._v(" Nginx 站点配置")]),s._v(" "),t("p",[s._v("根据 "),t("a",{attrs:{href:"https://learnku.com/docs/laravel/5.8/deployment",target:"_blank",rel:"noopener noreferrer"}},[s._v("Laravel 5.8 部署文档"),t("OutboundLink")],1),s._v(" 的说明，我们可直接拿到一份现成的 Nginx 配置文件，稍作调整即可：")]),s._v(" "),t("div",{staticClass:"language-nginx extra-class"},[t("pre",{pre:!0,attrs:{class:"language-nginx"}},[t("code",[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("server")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("listen")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("80")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("server_name")]),s._v(" laravel"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("deployment"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("wi1dcard"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("cn"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 此为必修改项，请替换为服务器公网 IP 或域名")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("root")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("var"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("www"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("deployment"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("public"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 此为必修改项，请注意指向站点根目录的 public 子目录")]),s._v("\n\n    "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("add_header")]),s._v(" X"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("Frame"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("Options "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"SAMEORIGIN"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("add_header")]),s._v(" X"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("XSS"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("Protection "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"1; mode=block"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("add_header")]),s._v(" X"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("Content"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("Type"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("Options "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"nosniff"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\n    "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("index")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("index")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("html "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("index")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("htm "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("index")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("php"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\n    "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("charset")]),s._v(" utf"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("8")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\n    "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("location")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("try_files")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$uri")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$uri")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("index")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("php"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("?")]),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$query_string")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n\n    "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("location")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("favicon"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("ico "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("access_log")]),s._v(" off"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("log_not_found")]),s._v(" off"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("location")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("robots"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("txt  "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("access_log")]),s._v(" off"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("log_not_found")]),s._v(" off"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n\n    "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("error_page")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("404")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("index")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("php"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\n    "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("location")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("~")]),s._v(" \\"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("php$ "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("fastcgi_pass")]),s._v(" unix"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("var"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("run"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("php"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("php7"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("fpm"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("sock"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 请注意核对 PHP 版本")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("fastcgi_index")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("index")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("php"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("fastcgi_param")]),s._v(" SCRIPT_FILENAME "),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$realpath_root")]),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$fastcgi_script_name")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("include")]),s._v(" fastcgi_params"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n\n    "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("location")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("~")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("\\"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("?")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("!")]),s._v("well"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("known"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("*")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("deny")]),s._v(" all"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])])]),t("blockquote",[t("p",[s._v("提示：关于以上 Nginx 配置项的解析，可参见 "),t("a",{attrs:{href:"https://wi1dcard.cn/posts/laravel-recommended-nginx-conf-analysis/",target:"_blank",rel:"noopener noreferrer"}},[s._v("这篇博客"),t("OutboundLink")],1),s._v("。")])]),s._v(" "),t("p",[s._v("通常我们仅需修改 "),t("code",[s._v("server_name")]),s._v("、"),t("code",[s._v("root")]),s._v(" 和 "),t("code",[s._v("fastcgi_pass")]),s._v("；请注意阅读 "),t("code",[s._v("#")]),s._v(" 后的注释。")]),s._v(" "),t("p",[s._v("我们将以上内容保存到本地文件（例如 "),t("code",[s._v("deployment.conf")]),s._v("）内，使用 SCP 即可上传至服务器：")]),s._v(" "),t("div",{staticClass:"language-bash extra-class"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[s._v("$ "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("scp")]),s._v(" ~/deployment.conf root@laravel-deployment.wi1dcard.cn:/etc/nginx/sites-enabled/\n")])])]),t("blockquote",[t("p",[s._v("提示：如果你熟悉 "),t("code",[s._v("vi")]),s._v(" 等文本编辑器，也可以直接在服务器上操作，此处不再展开。")])]),s._v(" "),t("p",[s._v("其中：")]),s._v(" "),t("ul",[t("li",[t("code",[s._v("~/deployment.conf")]),s._v(" 请替换为配置文件的实际保存路径，该路径位于本地。")]),s._v(" "),t("li",[t("code",[s._v("/etc/nginx/sites-enabled/")]),s._v(" 为存放 Nginx 站点配置的目录，该目录位于服务器。")])]),s._v(" "),t("h3",{attrs:{id:"重载-nginx"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#重载-nginx"}},[s._v("#")]),s._v(" 重载 Nginx")]),s._v(" "),t("p",[s._v("配置完成后，请务必重启（Restart）或重载（Reload）Nginx。")]),s._v(" "),t("p",[s._v("什么是 "),t("strong",[s._v("重载")]),s._v("？实际上，直接重启 Nginx 是不安全的。原因有二：")]),s._v(" "),t("ul",[t("li",[s._v("在 Nginx 进程结束再重新运行的过程中，将造成极短时间的闪断。虽然这一时间通常很短（一般来说在秒级别），但倘若面对大量并发，还是极易造成一部分请求无法访问，即服务中断。")]),s._v(" "),t("li",[s._v("在重启的过程中，若此时 Nginx 恰好正在处理请求，与客户端的 TCP 连接将会断开，客户端无法收到正确响应，造成前后端信息不一致。")])]),s._v(" "),t("p",[s._v("在之前的小节中，已经提到重启 Nginx 的方法；")]),s._v(" "),t("div",{staticClass:"language-bash extra-class"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[s._v("$ "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("service")]),s._v(" nginx restart\n")])])]),t("p",[s._v("同样地，亦可使用 "),t("code",[s._v("service")]),s._v(" 命令重载 Nginx：")]),s._v(" "),t("div",{staticClass:"language-bash extra-class"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[s._v("$ "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("service")]),s._v(" nginx reload\n")])])]),t("p",[s._v("另一种等效的方法是：")]),s._v(" "),t("div",{staticClass:"language-bash extra-class"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[s._v("$ nginx -s reload\n")])])]),t("h3",{attrs:{id:"最终效果"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#最终效果"}},[s._v("#")]),s._v(" 最终效果")]),s._v(" "),t("p",[s._v("在浏览器内输入服务器公网 IP 或域名并访问，你将会看到 Laravel 应用的默认主页：")]),s._v(" "),t("p",[t("img",{attrs:{src:"https://raw.githubusercontent.com/wi1dcard/laravel-deployment/master/src/images/f3eede815abbbd80a255d1c6c9da0b1c.png",alt:"img"}})]),s._v(" "),t("p",[s._v("恭喜你，部署成功。")]),s._v(" "),t("h2",{attrs:{id:"生产环境的必要优化"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#生产环境的必要优化"}},[s._v("#")]),s._v(" 生产环境的必要优化")]),s._v(" "),t("h3",{attrs:{id:"nginx-配置"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#nginx-配置"}},[s._v("#")]),s._v(" Nginx 配置")]),s._v(" "),t("p",[s._v("对于 Laravel 应用来说，优化 Nginx 配置所带来的性能提升可谓微不足道。因此不建议在中小型项目中花费较多精力调优 Nginx。")]),s._v(" "),t("p",[s._v("不过，有一点值得注意：")]),s._v(" "),t("div",{staticClass:"language-php extra-class"},[t("pre",{pre:!0,attrs:{class:"language-php"}},[t("code",[s._v("server "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token shell-comment comment"}},[s._v("# ...")]),s._v("\n    location "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("~")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("*")]),s._v(" \\"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("js"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("css"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("$ "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n        expires "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("24")]),s._v("h"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token shell-comment comment"}},[s._v("#...")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])])]),t("p",[s._v("通过以上配置，可使 Nginx 匹配请求 URI，若以 "),t("code",[s._v("js")]),s._v(" 或 "),t("code",[s._v("css")]),s._v(" 结尾，则将响应头 "),t("code",[s._v("Expires")]),s._v(" 的值设置为 "),t("code",[s._v("24h")]),s._v("返回。客户端浏览器将根据该值建立资源缓存，并在指定时间后过期，因此可节省部分服务器静态资源流量。"),t("code",[s._v("24h")]),s._v(" 可根据需要调整，若使用 CDN 服务分发静态资源，则不必配置此项。")]),s._v(" "),t("h3",{attrs:{id:"laravel-的配置缓存与路由缓存"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#laravel-的配置缓存与路由缓存"}},[s._v("#")]),s._v(" Laravel 的配置缓存与路由缓存")]),s._v(" "),t("p",[s._v("开启 "),t("strong",[s._v("配置缓存")]),s._v(" 和 "),t("strong",[s._v("路由缓存")]),s._v(" 能够在一定程度上提升 Laravel 的性能。")]),s._v(" "),t("div",{staticClass:"language-bash extra-class"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[s._v("$ php artisan config:cache "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 生成配置缓存")]),s._v("\n")])])]),t("blockquote",[t("p",[s._v("注意：当开启配置缓存后，"),t("code",[s._v("env()")]),s._v(" 函数将会失效；它将会永远返回 "),t("code",[s._v("null")]),s._v("；因此务必确保在非配置文件内，未直接调用该函数。")])]),s._v(" "),t("div",{staticClass:"language-bash extra-class"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[s._v("$ php artisan route:cache "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 生成路由缓存")]),s._v("\n")])])]),t("blockquote",[t("p",[s._v("注意：路由缓存仅支持控制器风格；若路由注册时存在闭包（Closures），则无法使用该功能。")]),s._v(" "),t("p",[s._v("注意：生成缓存后，对配置和路由的修改将不会生效，需再次执行缓存命令，或使用 "),t("code",[s._v("php artisan cache:clear")]),s._v(" 命令清除它们。")])]),s._v(" "),t("h3",{attrs:{id:"composer"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#composer"}},[s._v("#")]),s._v(" Composer")]),s._v(" "),t("p",[s._v("在安装依赖时，建议使用以下命令：")]),s._v(" "),t("div",{staticClass:"language-bash extra-class"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[s._v("$ composer "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("install")]),s._v(" --optimize-autoloader --no-dev\n")])])]),t("p",[s._v("其中，"),t("code",[s._v("--optimize-autoloader")]),s._v(" 表示生成优化后的自动加载器，虽然生成过程可能较慢，但换来的是提高运行时的效率。"),t("code",[s._v("--no-dev")]),s._v(" 表示不安装 composer.json 中 "),t("code",[s._v("require-dev")]),s._v(" 声明的扩展包，在生产环境中我们不需要这些开发依赖。")]),s._v(" "),t("h3",{attrs:{id:"再谈文件权限"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#再谈文件权限"}},[s._v("#")]),s._v(" 再谈文件权限")]),s._v(" "),t("p",[s._v("文件权限直接关系到服务器安全与否。通常情况下，我们应当遵循「最小权限原则」，即权限越小越好。对于 Laravel 来说，我个人比较倾向的权限配置为 "),t("code",[s._v("750")]),s._v("：")]),s._v(" "),t("div",{staticClass:"language-bash extra-class"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[s._v("$ "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("chmod")]),s._v(" -R "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("750")]),s._v(" /var/www/deployment\n")])])]),t("p",[s._v("你可以通过在线工具 "),t("a",{attrs:{href:"https://chmod-calculator.com/",target:"_blank",rel:"noopener noreferrer"}},[s._v("Chmod Calculator"),t("OutboundLink")],1),s._v(" 来解析八进制权限数字：")]),s._v(" "),t("p",[s._v("以上是 "),t("code",[s._v("750")]),s._v(" 所代表的权限，即文件所有者可 "),t("strong",[s._v("读、写、执行")]),s._v("，文件所有组可 "),t("strong",[s._v("读、执行")]),s._v("，其余用户 "),t("strong",[s._v("均不可")]),s._v("。")]),s._v(" "),t("p",[s._v("也就是说，运行 Nginx 和 PHP-FPM 的 "),t("code",[s._v("www-data")]),s._v(" 用户，可读、写、执行；"),t("code",[s._v("www-data")]),s._v(" 用户组内的用户可读、执行。")]),s._v(" "),t("p",[s._v("更加严格安全的另一个权限推荐是 "),t("code",[s._v("640")]),s._v("，不过务必确保 "),t("code",[s._v("www-data")]),s._v(" 用户具备 "),t("code",[s._v("bootstrap/cache")]),s._v(" 和 "),t("code",[s._v("storage")]),s._v(" 目录的 "),t("strong",[s._v("读、写")]),s._v(" 权限，在 Laravel 应用运行过程中是需要读写它们的。")]),s._v(" "),t("h3",{attrs:{id:"杂项"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#杂项"}},[s._v("#")]),s._v(" 杂项")]),s._v(" "),t("p",[s._v("根据应用本身的逻辑不同，涉及的 Laravel 功能也不一样。针对部分项目，你有可能还需要执行以下 Artisan 命令：")]),s._v(" "),t("div",{staticClass:"language-bash extra-class"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[s._v("$ php artisan storage:link "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 软链接 app/storage 到 public 目录，以便公开访问")]),s._v("\n$ php artisan migrate "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 执行迁移")]),s._v("\n$ php artisan db:seed "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 执行数据填充")]),s._v("\n")])])])])}),[],!1,null,null,null);a.default=n.exports}}]);