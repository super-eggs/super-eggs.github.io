<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>laravel学习笔记 | SuperEggs</title>
    <meta name="generator" content="VuePress 1.5.4">
    <link rel="shortcut icon" href="/log.ico" type="image/jpg">
    <script>
            var _hmt = _hmt || [];
            (function() {
                var hm = document.createElement("script");
                hm.src = "https://hm.baidu.com/hm.js";
                var s = document.getElementsByTagName("script")[0];
                s.parentNode.insertBefore(hm, s);
            })();
        </script>
    <script src="/js/jquery-3.5.min.js"></script>
    <script src="/js/cursor.min.js"></script>
    <meta name="description" content="分享生活高效技能,保持勇敢，坚持有趣，生命不息，折腾不止！">
    <meta property="og:site_name" content="SuperEggs">
    <meta property="og:title" content="laravel学习笔记">
    <meta property="og:type" content="website">
    <meta property="og:url" content="/Code/LaraCode.html">
    <meta name="twitter:title" content="laravel学习笔记">
    <meta name="twitter:url" content="/Code/LaraCode.html">
    <meta name="twitter:card" content="summary_large_image">
    <meta name="keywords" content="html,css,jquery,thinkphp,laravel,docker,linux,manjaro">
    <meta name="auther" content="SuperEggs">
    <link rel="preload" href="/assets/css/0.styles.5f689f29.css" as="style"><link rel="preload" href="/assets/js/app.693e6c19.js" as="script"><link rel="preload" href="/assets/js/2.3304c2e1.js" as="script"><link rel="preload" href="/assets/js/8.51a4d2f9.js" as="script"><link rel="prefetch" href="/assets/js/10.34123518.js"><link rel="prefetch" href="/assets/js/11.f0e24eb8.js"><link rel="prefetch" href="/assets/js/12.5e75a974.js"><link rel="prefetch" href="/assets/js/13.db0bf381.js"><link rel="prefetch" href="/assets/js/14.ed324319.js"><link rel="prefetch" href="/assets/js/15.f40e8254.js"><link rel="prefetch" href="/assets/js/16.d8f963c5.js"><link rel="prefetch" href="/assets/js/17.250470cc.js"><link rel="prefetch" href="/assets/js/18.5161c52b.js"><link rel="prefetch" href="/assets/js/19.afb8dd7a.js"><link rel="prefetch" href="/assets/js/20.c8248808.js"><link rel="prefetch" href="/assets/js/21.e818d83d.js"><link rel="prefetch" href="/assets/js/22.69d0a99c.js"><link rel="prefetch" href="/assets/js/23.92b9837f.js"><link rel="prefetch" href="/assets/js/24.124a82a4.js"><link rel="prefetch" href="/assets/js/25.1c0271e6.js"><link rel="prefetch" href="/assets/js/26.34e44644.js"><link rel="prefetch" href="/assets/js/27.4f89b112.js"><link rel="prefetch" href="/assets/js/28.82ed427e.js"><link rel="prefetch" href="/assets/js/29.64fae044.js"><link rel="prefetch" href="/assets/js/3.1c0cc69b.js"><link rel="prefetch" href="/assets/js/30.dc7d1b9b.js"><link rel="prefetch" href="/assets/js/31.a273a940.js"><link rel="prefetch" href="/assets/js/32.ca99c448.js"><link rel="prefetch" href="/assets/js/33.4129d67d.js"><link rel="prefetch" href="/assets/js/34.a49e24e6.js"><link rel="prefetch" href="/assets/js/35.4ba458c0.js"><link rel="prefetch" href="/assets/js/36.7412ff8c.js"><link rel="prefetch" href="/assets/js/37.35c3a72c.js"><link rel="prefetch" href="/assets/js/38.ebf390fb.js"><link rel="prefetch" href="/assets/js/39.6b308832.js"><link rel="prefetch" href="/assets/js/4.e5a930e9.js"><link rel="prefetch" href="/assets/js/40.968d571d.js"><link rel="prefetch" href="/assets/js/41.a1f587bf.js"><link rel="prefetch" href="/assets/js/42.9f358bc3.js"><link rel="prefetch" href="/assets/js/43.4f19f41e.js"><link rel="prefetch" href="/assets/js/44.a27ad98a.js"><link rel="prefetch" href="/assets/js/45.fb26a2d8.js"><link rel="prefetch" href="/assets/js/46.aa66c6d7.js"><link rel="prefetch" href="/assets/js/47.00ae1556.js"><link rel="prefetch" href="/assets/js/48.699e8e33.js"><link rel="prefetch" href="/assets/js/49.0f79ef04.js"><link rel="prefetch" href="/assets/js/5.2d78753d.js"><link rel="prefetch" href="/assets/js/50.2428dcc2.js"><link rel="prefetch" href="/assets/js/51.829dcccc.js"><link rel="prefetch" href="/assets/js/52.f2dfda6b.js"><link rel="prefetch" href="/assets/js/53.225de2db.js"><link rel="prefetch" href="/assets/js/54.b91ed453.js"><link rel="prefetch" href="/assets/js/55.25bacde7.js"><link rel="prefetch" href="/assets/js/56.2a58cece.js"><link rel="prefetch" href="/assets/js/57.48eab866.js"><link rel="prefetch" href="/assets/js/58.5cf8ca6e.js"><link rel="prefetch" href="/assets/js/59.458178cc.js"><link rel="prefetch" href="/assets/js/6.66329e4b.js"><link rel="prefetch" href="/assets/js/60.7898b9b9.js"><link rel="prefetch" href="/assets/js/61.5f651468.js"><link rel="prefetch" href="/assets/js/62.cd190cb0.js"><link rel="prefetch" href="/assets/js/63.0d472232.js"><link rel="prefetch" href="/assets/js/64.e8a8ffe7.js"><link rel="prefetch" href="/assets/js/65.8a66ff7d.js"><link rel="prefetch" href="/assets/js/66.0492741b.js"><link rel="prefetch" href="/assets/js/67.204dadcb.js"><link rel="prefetch" href="/assets/js/68.7d5b0a8f.js"><link rel="prefetch" href="/assets/js/69.ed735059.js"><link rel="prefetch" href="/assets/js/7.44229983.js"><link rel="prefetch" href="/assets/js/70.0f643f0b.js"><link rel="prefetch" href="/assets/js/71.a226be62.js"><link rel="prefetch" href="/assets/js/9.ee30d1ab.js">
    <link rel="stylesheet" href="/assets/css/0.styles.5f689f29.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><img src="/log.png" alt="SuperEggs" class="logo"> <span class="site-name can-hide">SuperEggs</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/" class="nav-link">
  Home
</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="工具软件" class="dropdown-title"><span class="title">工具软件</span> <span class="arrow down"></span></button> <button type="button" aria-label="工具软件" class="mobile-dropdown-title"><span class="title">工具软件</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/Tool/windows.html" class="nav-link">
  Windows
</a></li><li class="dropdown-item"><!----> <a href="/Tool/01brew.html" class="nav-link">
  Brew
</a></li><li class="dropdown-item"><!----> <a href="/Tool/02yarn.html" class="nav-link">
  Yarn
</a></li><li class="dropdown-item"><!----> <a href="/Tool/git.html" class="nav-link">
  Git
</a></li><li class="dropdown-item"><!----> <a href="/Tool/goland.html" class="nav-link">
  Goland
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="go" class="dropdown-title"><span class="title">go</span> <span class="arrow down"></span></button> <button type="button" aria-label="go" class="mobile-dropdown-title"><span class="title">go</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/Go/" class="nav-link">
  go Wiki
</a></li><li class="dropdown-item"><!----> <a href="/Go_Practice/" class="nav-link">
  go 实践
</a></li><li class="dropdown-item"><!----> <a href="/Go_Packages/" class="nav-link">
  go 包
</a></li></ul></div></div><div class="nav-item"><a href="/Laravel/" class="nav-link">
  Laravel
</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="开发环境" class="dropdown-title"><span class="title">开发环境</span> <span class="arrow down"></span></button> <button type="button" aria-label="开发环境" class="mobile-dropdown-title"><span class="title">开发环境</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/Wamp/" class="nav-link">
  Docker
</a></li><li class="dropdown-item"><!----> <a href="/Linux/Config.html" class="nav-link">
  配置文件
</a></li><li class="dropdown-item"><!----> <a href="/Linux/Tool.html" class="nav-link">
  生产工具
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="Code" class="dropdown-title"><span class="title">Code</span> <span class="arrow down"></span></button> <button type="button" aria-label="Code" class="mobile-dropdown-title"><span class="title">Code</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><h4>
          Html
        </h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/Code/Css.html" class="nav-link">
  Css样式收藏
</a></li><li class="dropdown-subitem"><a href="/Code/Layui.html" class="nav-link">
  Layui笔记
</a></li><li class="dropdown-subitem"><a href="/Code/Javascript.html" class="nav-link">
  Javascript手册
</a></li><li class="dropdown-subitem"><a href="/Code/Menu.html" class="nav-link">
  在线手册
</a></li></ul></li><li class="dropdown-item"><!----> <a href="/Code/VueNote.html" class="nav-link">
  Vue
</a></li><li class="dropdown-item"><h4>
          Php
        </h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/Code/Php.html" class="nav-link">
  Php使用技巧
</a></li><li class="dropdown-subitem"><a href="/Code/Thinkphp.html" class="nav-link">
  ThinkPhp
</a></li><li class="dropdown-subitem"><a href="/Code/LaraCode.html" aria-current="page" class="nav-link router-link-exact-active router-link-active">
  LaraCode
</a></li></ul></li></ul></div></div><div class="nav-item"><a href="/MyNote/" class="nav-link">
  MyNote
</a></div><div class="nav-item"><a href="/WebNote/" class="nav-link">
  WebNote
</a></div><div class="nav-item"><a href="/EMS/" class="nav-link">
  EMS
</a></div> <a href="https://github.com/super-eggs/vuepress-blog" target="_blank" rel="noopener noreferrer" class="repo-link">
    查看源码
    <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/" class="nav-link">
  Home
</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="工具软件" class="dropdown-title"><span class="title">工具软件</span> <span class="arrow down"></span></button> <button type="button" aria-label="工具软件" class="mobile-dropdown-title"><span class="title">工具软件</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/Tool/windows.html" class="nav-link">
  Windows
</a></li><li class="dropdown-item"><!----> <a href="/Tool/01brew.html" class="nav-link">
  Brew
</a></li><li class="dropdown-item"><!----> <a href="/Tool/02yarn.html" class="nav-link">
  Yarn
</a></li><li class="dropdown-item"><!----> <a href="/Tool/git.html" class="nav-link">
  Git
</a></li><li class="dropdown-item"><!----> <a href="/Tool/goland.html" class="nav-link">
  Goland
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="go" class="dropdown-title"><span class="title">go</span> <span class="arrow down"></span></button> <button type="button" aria-label="go" class="mobile-dropdown-title"><span class="title">go</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/Go/" class="nav-link">
  go Wiki
</a></li><li class="dropdown-item"><!----> <a href="/Go_Practice/" class="nav-link">
  go 实践
</a></li><li class="dropdown-item"><!----> <a href="/Go_Packages/" class="nav-link">
  go 包
</a></li></ul></div></div><div class="nav-item"><a href="/Laravel/" class="nav-link">
  Laravel
</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="开发环境" class="dropdown-title"><span class="title">开发环境</span> <span class="arrow down"></span></button> <button type="button" aria-label="开发环境" class="mobile-dropdown-title"><span class="title">开发环境</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/Wamp/" class="nav-link">
  Docker
</a></li><li class="dropdown-item"><!----> <a href="/Linux/Config.html" class="nav-link">
  配置文件
</a></li><li class="dropdown-item"><!----> <a href="/Linux/Tool.html" class="nav-link">
  生产工具
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="Code" class="dropdown-title"><span class="title">Code</span> <span class="arrow down"></span></button> <button type="button" aria-label="Code" class="mobile-dropdown-title"><span class="title">Code</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><h4>
          Html
        </h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/Code/Css.html" class="nav-link">
  Css样式收藏
</a></li><li class="dropdown-subitem"><a href="/Code/Layui.html" class="nav-link">
  Layui笔记
</a></li><li class="dropdown-subitem"><a href="/Code/Javascript.html" class="nav-link">
  Javascript手册
</a></li><li class="dropdown-subitem"><a href="/Code/Menu.html" class="nav-link">
  在线手册
</a></li></ul></li><li class="dropdown-item"><!----> <a href="/Code/VueNote.html" class="nav-link">
  Vue
</a></li><li class="dropdown-item"><h4>
          Php
        </h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/Code/Php.html" class="nav-link">
  Php使用技巧
</a></li><li class="dropdown-subitem"><a href="/Code/Thinkphp.html" class="nav-link">
  ThinkPhp
</a></li><li class="dropdown-subitem"><a href="/Code/LaraCode.html" aria-current="page" class="nav-link router-link-exact-active router-link-active">
  LaraCode
</a></li></ul></li></ul></div></div><div class="nav-item"><a href="/MyNote/" class="nav-link">
  MyNote
</a></div><div class="nav-item"><a href="/WebNote/" class="nav-link">
  WebNote
</a></div><div class="nav-item"><a href="/EMS/" class="nav-link">
  EMS
</a></div> <a href="https://github.com/super-eggs/vuepress-blog" target="_blank" rel="noopener noreferrer" class="repo-link">
    查看源码
    <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></nav>  <ul class="sidebar-links"><li><section class="sidebar-group depth-0"><p class="sidebar-heading open"><span>laravel学习笔记</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/Code/LaraCode.html#安装前端脚手架" class="sidebar-link">安装前端脚手架</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/Code/LaraCode.html#npm-package" class="sidebar-link">npm package</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/Code/LaraCode.html#laravel-ide-helper" class="sidebar-link">Laravel IDE Helper</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/Code/LaraCode.html#laravel-引入中文语言包" class="sidebar-link">laravel 引入中文语言包</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/Code/LaraCode.html#配置中国时间" class="sidebar-link">配置中国时间</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/Code/LaraCode.html#laravel周期" class="sidebar-link">laravel周期</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/Code/LaraCode.html#laravel使用factory填充数据" class="sidebar-link">laravel使用factory填充数据</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/Code/LaraCode.html#设置中文数据" class="sidebar-link">设置中文数据</a></li><li class="sidebar-sub-header"><a href="/Code/LaraCode.html#创建迁移文件" class="sidebar-link">创建迁移文件</a></li><li class="sidebar-sub-header"><a href="/Code/LaraCode.html#创建工厂数据" class="sidebar-link">创建工厂数据</a></li><li class="sidebar-sub-header"><a href="/Code/LaraCode.html#填充数据" class="sidebar-link">填充数据</a></li></ul></li><li><a href="/Code/LaraCode.html#获取原始数据" class="sidebar-link">获取原始数据</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/Code/LaraCode.html#时间搜索" class="sidebar-link">时间搜索</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/Code/LaraCode.html#手动表单验证-api验证" class="sidebar-link">手动表单验证（api验证）</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/Code/LaraCode.html#scope使用" class="sidebar-link">scope使用</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/Code/LaraCode.html#laravel中使用redis" class="sidebar-link">Laravel中使用redis</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/Code/LaraCode.html#laravel8广播-pusher" class="sidebar-link">laravel8广播+pusher</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/Code/LaraCode.html#安装pusher驱动" class="sidebar-link">安装pusher驱动</a></li></ul></li><li><a href="/Code/LaraCode.html#laravel8广播-websocket" class="sidebar-link">laravel8广播+websocket</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/Code/LaraCode.html#安装laravel-和前端脚手架" class="sidebar-link">安装laravel 和前端脚手架</a></li><li class="sidebar-sub-header"><a href="/Code/LaraCode.html#安装-laravel-websocket" class="sidebar-link">安装 laravel/websocket</a></li><li class="sidebar-sub-header"><a href="/Code/LaraCode.html#安装-pusher" class="sidebar-link">安装 pusher</a></li><li class="sidebar-sub-header"><a href="/Code/LaraCode.html#安装前端库" class="sidebar-link">安装前端库</a></li><li class="sidebar-sub-header"><a href="/Code/LaraCode.html#创建事件" class="sidebar-link">创建事件</a></li></ul></li><li><a href="/Code/LaraCode.html#laravel8广播-redis" class="sidebar-link">laravel8广播-redis</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/Code/LaraCode.html#安装redis广播库" class="sidebar-link">安装redis广播库</a></li><li class="sidebar-sub-header"><a href="/Code/LaraCode.html#安装前端依赖" class="sidebar-link">安装前端依赖</a></li><li class="sidebar-sub-header"><a href="/Code/LaraCode.html#开启广播" class="sidebar-link">开启广播</a></li><li class="sidebar-sub-header"><a href="/Code/LaraCode.html#创建一个公有广播事件" class="sidebar-link">创建一个公有广播事件</a></li><li class="sidebar-sub-header"><a href="/Code/LaraCode.html#私有广播事件" class="sidebar-link">私有广播事件</a></li><li class="sidebar-sub-header"><a href="/Code/LaraCode.html#广播使用redis" class="sidebar-link">广播使用redis</a></li></ul></li><li><a href="/Code/LaraCode.html#laravel广播-redis-laradock" class="sidebar-link">laravel广播+redis+laradock</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/Code/LaraCode.html#laradock-laravel-redis广播" class="sidebar-link">Laradock+Laravel+redis广播</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/Code/LaraCode.html#注意事项" class="sidebar-link">注意事项</a></li></ul></li></ul></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h2 id="安装前端脚手架"><a href="#安装前端脚手架" class="header-anchor">#</a> 安装前端脚手架</h2> <div class="language- extra-class"><pre class="language-text"><code>omposer create-project --prefer-dist laravel/laravel

laravel new app
</code></pre></div><p>有时候在window下安装会提示一些插件错误可以跳过插件检查</p> <div class="language-bash extra-class"><pre class="language-bash"><code>composer <span class="token function">install</span> --ignore-platform-reqs
</code></pre></div><p>安装基础脚手架</p> <div class="language-bash extra-class"><pre class="language-bash"><code>composer require laravel/ui --dev

// 生成 登陆/注册 脚手架<span class="token punctuation">..</span>.
php artisan ui bootstrap --auth
php artisan ui vue --auth
php artisan ui react --auth

<span class="token function">npm</span> <span class="token function">install</span> --save laravel-echo pusher-js

<span class="token function">npm</span> i <span class="token operator">&amp;&amp;</span> <span class="token function">npm</span> run <span class="token function">watch</span>

// 热加载 webpack.mix.js
mix.browserSync<span class="token punctuation">(</span><span class="token string">'websocket.test'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>一键命令</p> <div class="language-bash extra-class"><pre class="language-bash"><code>php artisan ui vue --auth
</code></pre></div><h2 id="npm-package"><a href="#npm-package" class="header-anchor">#</a> npm package</h2> <div class="language-bash extra-class"><pre class="language-bash"><code><span class="token function">npm</span> i mdui vuex vue-router Axios vue-m-message --save
</code></pre></div><h2 id="laravel-ide-helper"><a href="#laravel-ide-helper" class="header-anchor">#</a> Laravel IDE Helper</h2> <blockquote><p>https://github.com/barryvdh/laravel-ide-helper</p></blockquote> <div class="language-bash extra-class"><pre class="language-bash"><code>composer require --dev barryvdh/laravel-ide-helper
</code></pre></div><ul><li><p>add the package to the <code>extra.laravel.dont-discover</code> key in <code>composer.json</code></p> <div class="language- extra-class"><pre class="language-text"><code>&quot;extra&quot;: {
  &quot;laravel&quot;: {
    &quot;dont-discover&quot;: [
      &quot;barryvdh/laravel-ide-helper&quot;
    ]
  }
}
</code></pre></div></li> <li><p>Add the following class to the <code>providers</code> array in <code>config/app.php</code></p> <div class="language- extra-class"><pre class="language-text"><code>Barryvdh\LaravelIdeHelper\IdeHelperServiceProvider::class,
</code></pre></div><p>If you want to manually load it only in non-production environments, instead you can add this to your <code>AppServiceProvider</code> with the <code>register()</code> method:</p> <div class="language-php extra-class"><pre class="language-php"><code><span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function">register</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token property">app</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">isLocal</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token property">app</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">register</span><span class="token punctuation">(</span>\<span class="token package">Barryvdh<span class="token punctuation">\</span>LaravelIdeHelper<span class="token punctuation">\</span>IdeHelperServiceProvider</span><span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token comment">// ...</span>
<span class="token punctuation">}</span>
</code></pre></div></li> <li><p>run</p> <div class="language-bash extra-class"><pre class="language-bash"><code>php artisan ide-helper:generate
</code></pre></div><p>checked<code>,</code>email<code>,</code>is_admin<code>,</code>password<code>,</code>phone<code>,</code>usernam
e</p></li></ul> <h2 id="laravel-引入中文语言包"><a href="#laravel-引入中文语言包" class="header-anchor">#</a> <a href="https://www.cnblogs.com/clubs/p/12562790.html" target="_blank" rel="noopener noreferrer">laravel 引入中文语言包<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></h2> <p>第一步：</p> <div class="language- extra-class"><pre class="language-text"><code>composer require overtrue/laravel-lang
</code></pre></div><p>第二步：</p> <p>安装成功后，在config/app.php文件中将以下这一行：</p> <div class="language- extra-class"><pre class="language-text"><code>Illuminate\Translation\TranslationServiceProvider::class,
</code></pre></div><p>替换为：</p> <div class="language- extra-class"><pre class="language-text"><code>Overtrue\LaravelLang\TranslationServiceProvider::class,
</code></pre></div><p>第三步：</p> <p>config/app.php 修改</p> <div class="language- extra-class"><pre class="language-text"><code>'locale' =&gt; 'zh-CN',
</code></pre></div><p>中文语言包引用结束</p> <p>表单验证错误信息显示为中文：</p> <div class="language- extra-class"><pre class="language-text"><code>faker_locale = 'zh-CN'
</code></pre></div><h2 id="配置中国时间"><a href="#配置中国时间" class="header-anchor">#</a> 配置中国时间</h2> <p>1、<code>config/app.php</code></p> <div class="language-php extra-class"><pre class="language-php"><code><span class="token single-quoted-string string">'timezone'</span> <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token single-quoted-string string">'Asia/Shanghai'</span><span class="token punctuation">,</span>
<span class="token single-quoted-string string">'locale'</span> <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token single-quoted-string string">'zh-CN'</span><span class="token punctuation">,</span>
<span class="token single-quoted-string string">'faker_locale'</span> <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token single-quoted-string string">'zh-CN'</span><span class="token punctuation">,</span>
</code></pre></div><p>2、Model中添加</p> <div class="language-php extra-class"><pre class="language-php"><code><span class="token keyword">protected</span> <span class="token variable">$dateFormat</span> <span class="token operator">=</span> <span class="token single-quoted-string string">'U'</span><span class="token punctuation">;</span>
<span class="token comment">// 时间配置</span>
<span class="token keyword">protected</span> <span class="token keyword">function</span> <span class="token function">serializeDate</span><span class="token punctuation">(</span>\<span class="token package">DateTimeInterface</span> <span class="token variable">$date</span><span class="token punctuation">)</span>
<span class="token punctuation">{</span>
	<span class="token keyword">return</span> <span class="token variable">$date</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">format</span><span class="token punctuation">(</span><span class="token single-quoted-string string">'Y-m-d H:i:s'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><h2 id="laravel周期"><a href="#laravel周期" class="header-anchor">#</a> laravel周期</h2> <p>控制器构造方法 -&gt; 父类构造方法 -&gt; 中间件构造方法</p> <h2 id="laravel使用factory填充数据"><a href="#laravel使用factory填充数据" class="header-anchor">#</a> laravel使用factory填充数据</h2> <h3 id="设置中文数据"><a href="#设置中文数据" class="header-anchor">#</a> 设置中文数据</h3> <div class="language-php extra-class"><pre class="language-php"><code><span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function">definition</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        <span class="token variable">$faker</span> <span class="token operator">=</span> \<span class="token package">Faker<span class="token punctuation">\</span>Factory</span><span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token function">create</span><span class="token punctuation">(</span><span class="token double-quoted-string string">&quot;zh_CN&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> <span class="token punctuation">[</span>
            <span class="token double-quoted-string string">&quot;title&quot;</span> <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token variable">$faker</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token property">title</span>
        <span class="token punctuation">]</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

<span class="token comment">//通过配置文件配置</span>
<span class="token comment">// config\app.php</span>
faker_locale <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token single-quoted-string string">'zh_CN'</span>
</code></pre></div><h3 id="创建迁移文件"><a href="#创建迁移文件" class="header-anchor">#</a> 创建迁移文件</h3> <div class="language-bash extra-class"><pre class="language-bash"><code>php artisan make:model Demo -m
</code></pre></div><h3 id="创建工厂数据"><a href="#创建工厂数据" class="header-anchor">#</a> 创建工厂数据</h3> <div class="language-bash extra-class"><pre class="language-bash"><code>php artisan make:factory DemoFactory
</code></pre></div><h3 id="填充数据"><a href="#填充数据" class="header-anchor">#</a> 填充数据</h3> <div class="language-bash extra-class"><pre class="language-bash"><code>php artisan tinker
namespace App<span class="token punctuation">\</span>Models<span class="token punctuation">;</span>

Demo::factory<span class="token punctuation">(</span><span class="token punctuation">)</span>-<span class="token operator">&gt;</span>make<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> //测试，不会真的往数据库插入
Demo::factory<span class="token punctuation">(</span><span class="token punctuation">)</span>-<span class="token operator">&gt;</span>create<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> // 直接写入数据库
</code></pre></div><h2 id="获取原始数据"><a href="#获取原始数据" class="header-anchor">#</a> 获取原始数据</h2> <div class="language-php extra-class"><pre class="language-php"><code>Auth<span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token function">user</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">getAttributes</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token single-quoted-string string">'identity'</span><span class="token punctuation">]</span> <span class="token operator">==</span> <span class="token number">3</span>
</code></pre></div><h2 id="时间搜索"><a href="#时间搜索" class="header-anchor">#</a> 时间搜索</h2> <div class="language-php extra-class"><pre class="language-php"><code><span class="token comment">// 参数格式：2020-10-01 - 2020-10-31 （- 前后有空格）</span>
<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token keyword">empty</span><span class="token punctuation">(</span><span class="token variable">$datebt</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token variable">$datearr</span><span class="token operator">=</span><span class="token function">explode</span><span class="token punctuation">(</span><span class="token double-quoted-string string">&quot; - &quot;</span><span class="token punctuation">,</span><span class="token variable">$datebt</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token variable">$datebegin</span><span class="token operator">=</span><span class="token function">strtotime</span><span class="token punctuation">(</span><span class="token variable">$datearr</span><span class="token punctuation">[</span><span class="token single-quoted-string string">'0'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token variable">$dateend</span><span class="token operator">=</span><span class="token function">strtotime</span><span class="token punctuation">(</span><span class="token variable">$datearr</span><span class="token punctuation">[</span><span class="token single-quoted-string string">'1'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token variable">$map</span><span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token single-quoted-string string">'created_at'</span><span class="token punctuation">,</span><span class="token single-quoted-string string">'between'</span><span class="token punctuation">,</span><span class="token punctuation">[</span><span class="token variable">$datebegin</span><span class="token punctuation">,</span><span class="token variable">$dateend</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><h2 id="手动表单验证-api验证"><a href="#手动表单验证-api验证" class="header-anchor">#</a> 手动表单验证（api验证）</h2> <div class="language-php extra-class"><pre class="language-php"><code><span class="token variable">$param</span> <span class="token operator">=</span> <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token property">request</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">all</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token variable">$validate</span> <span class="token operator">=</span> Validator<span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token function">make</span><span class="token punctuation">(</span><span class="token variable">$param</span><span class="token punctuation">,</span><span class="token punctuation">[</span>
    <span class="token double-quoted-string string">&quot;username&quot;</span> <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token double-quoted-string string">&quot;required&quot;</span><span class="token punctuation">,</span>
    <span class="token double-quoted-string string">&quot;password&quot;</span> <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token double-quoted-string string">&quot;required&quot;</span>
<span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token punctuation">[</span>
    <span class="token double-quoted-string string">&quot;username.max&quot;</span> <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token double-quoted-string string">&quot;用户名不能为空！&quot;</span>
<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token variable">$validate</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">fails</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token keyword">return</span> <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">error</span><span class="token punctuation">(</span><span class="token variable">$validate</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">errors</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">first</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 获取验证错误的第一条信息</span>
</code></pre></div><h2 id="scope使用"><a href="#scope使用" class="header-anchor">#</a> scope使用</h2> <div class="language-php extra-class"><pre class="language-php"><code><span class="token comment">// model:命名规范：scope+驼峰名字（Status）</span>
<span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function">scopeStatus</span><span class="token punctuation">(</span><span class="token variable">$query</span><span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token variable">$query</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">where</span><span class="token punctuation">(</span><span class="token double-quoted-string string">&quot;status&quot;</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><div class="language-php extra-class"><pre class="language-php"><code><span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function">index</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token comment">//调用方式：直接写 scope后面的名称即可</span>
    <span class="token keyword">return</span> <span class="token function">response</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">json</span><span class="token punctuation">(</span>User<span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token function">Status</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 这样就取出status为1的数据</span>
<span class="token punctuation">}</span>
</code></pre></div><p>看不懂就参考：https://blog.csdn.net/qq175023117/article/details/101032253</p> <h2 id="laravel中使用redis"><a href="#laravel中使用redis" class="header-anchor">#</a> Laravel中使用redis</h2> <p>安装predis</p> <div class="language-bash extra-class"><pre class="language-bash"><code>composer require predis/predis
</code></pre></div><div class="language-php extra-class"><pre class="language-php"><code><span class="token php language-php"><span class="token delimiter important">&lt;?php</span>

<span class="token keyword">namespace</span> <span class="token package">App<span class="token punctuation">\</span>Http<span class="token punctuation">\</span>Controllers</span><span class="token punctuation">;</span>

<span class="token keyword">use</span> <span class="token package">Illuminate<span class="token punctuation">\</span>Support<span class="token punctuation">\</span>Facades<span class="token punctuation">\</span>Redis</span><span class="token punctuation">;</span>

<span class="token keyword">class</span> <span class="token class-name">Index</span> <span class="token keyword">extends</span> <span class="token class-name">Controller</span>
<span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function">index</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        Redis<span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token function">set</span><span class="token punctuation">(</span><span class="token double-quoted-string string">&quot;name&quot;</span><span class="token punctuation">,</span><span class="token double-quoted-string string">&quot;orangbus&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token variable">$name</span> <span class="token operator">=</span> Redis<span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token double-quoted-string string">&quot;name&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> <span class="token function">view</span><span class="token punctuation">(</span><span class="token double-quoted-string string">&quot;welcome&quot;</span><span class="token punctuation">,</span><span class="token function">compact</span><span class="token punctuation">(</span><span class="token double-quoted-string string">&quot;name&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</span></code></pre></div><h2 id="laravel8广播-pusher"><a href="#laravel8广播-pusher" class="header-anchor">#</a> laravel8广播+pusher</h2> <blockquote><p>使用广播之前自行安装好前端脚手架</p></blockquote> <p>第一先注册一个<code>pusher</code> 账号：https://pusher.com/</p> <p>创建应用，获取api信息，填入<code>.env</code>文件中，并修改驱动为<code>pusher</code></p> <div class="language-env extra-class"><pre class="language-text"><code>PUSHER_APP_ID=
PUSHER_APP_KEY=
PUSHER_APP_SECRET=
PUSHER_APP_CLUSTER=mt1

BROADCAST_DRIVER=pusher
</code></pre></div><h3 id="安装pusher驱动"><a href="#安装pusher驱动" class="header-anchor">#</a> 安装<code>pusher驱动</code></h3> <div class="language-bash extra-class"><pre class="language-bash"><code>composer require pusher/pusher-php-server <span class="token string">&quot;~4.0&quot;</span>
</code></pre></div><p>在 resources/js/bootstrap.js 文件中实例化 Echo 对象时 pusher</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">import</span> Echo <span class="token keyword">from</span> <span class="token string">'laravel-echo'</span><span class="token punctuation">;</span>

window<span class="token punctuation">.</span>Pusher <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'pusher-js'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

window<span class="token punctuation">.</span>Echo <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Echo</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
    broadcaster<span class="token operator">:</span> <span class="token string">'pusher'</span><span class="token punctuation">,</span>
    key<span class="token operator">:</span> process<span class="token punctuation">.</span>env<span class="token punctuation">.</span><span class="token constant">MIX_PUSHER_APP_KEY</span><span class="token punctuation">,</span> <span class="token comment">//这里修改为 pusher 的key</span>
    cluster<span class="token operator">:</span> process<span class="token punctuation">.</span>env<span class="token punctuation">.</span><span class="token constant">MIX_PUSHER_APP_CLUSTER</span><span class="token punctuation">,</span> <span class="token comment">//pusher的地区</span>
    forceTLS<span class="token operator">:</span> <span class="token boolean">false</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>创建Free事件，检验pusher是否配置ok</p> <div class="language-php extra-class"><pre class="language-php"><code>php artisan make<span class="token punctuation">:</span>event Free
</code></pre></div><p>编辑Free事件</p> <div class="language-php extra-class"><pre class="language-php"><code><span class="token php language-php"><span class="token delimiter important">&lt;?php</span>

<span class="token keyword">namespace</span> <span class="token package">App<span class="token punctuation">\</span>Events</span><span class="token punctuation">;</span>

<span class="token keyword">use</span> <span class="token package">Illuminate<span class="token punctuation">\</span>Broadcasting<span class="token punctuation">\</span>Channel</span><span class="token punctuation">;</span>
<span class="token keyword">use</span> <span class="token package">Illuminate<span class="token punctuation">\</span>Broadcasting<span class="token punctuation">\</span>InteractsWithSockets</span><span class="token punctuation">;</span>
<span class="token keyword">use</span> <span class="token package">Illuminate<span class="token punctuation">\</span>Broadcasting<span class="token punctuation">\</span>PresenceChannel</span><span class="token punctuation">;</span>
<span class="token keyword">use</span> <span class="token package">Illuminate<span class="token punctuation">\</span>Broadcasting<span class="token punctuation">\</span>PrivateChannel</span><span class="token punctuation">;</span>
<span class="token keyword">use</span> <span class="token package">Illuminate<span class="token punctuation">\</span>Contracts<span class="token punctuation">\</span>Broadcasting<span class="token punctuation">\</span>ShouldBroadcast</span><span class="token punctuation">;</span>
<span class="token keyword">use</span> <span class="token package">Illuminate<span class="token punctuation">\</span>Foundation<span class="token punctuation">\</span>Events<span class="token punctuation">\</span>Dispatchable</span><span class="token punctuation">;</span>
<span class="token keyword">use</span> <span class="token package">Illuminate<span class="token punctuation">\</span>Queue<span class="token punctuation">\</span>SerializesModels</span><span class="token punctuation">;</span>

<span class="token keyword">class</span> <span class="token class-name">Free</span> <span class="token keyword">implements</span> <span class="token class-name">ShouldBroadcast</span> <span class="token comment">//实现广播接口</span>
<span class="token punctuation">{</span>
    <span class="token keyword">use</span> <span class="token package">Dispatchable</span><span class="token punctuation">,</span> InteractsWithSockets<span class="token punctuation">,</span> SerializesModels<span class="token punctuation">;</span>
    
    <span class="token keyword">public</span> <span class="token variable">$msg</span><span class="token punctuation">;</span>

    <span class="token comment">/**
     * Create a new event instance.
     *
     * @return void
     */</span>
    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function">__construct</span><span class="token punctuation">(</span><span class="token variable">$msg</span><span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token property">msg</span> <span class="token operator">=</span> <span class="token variable">$msg</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token comment">/**
     * Get the channels the event should broadcast on.
     *
     * @return \Illuminate\Broadcasting\Channel|array
     */</span>
    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function">broadcastOn</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
<span class="token comment">//        return new PrivateChannel('channel-name');</span>
        <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">Channel</span><span class="token punctuation">(</span><span class="token single-quoted-string string">'cctv1'</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//公有频道名称</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

</span></code></pre></div><p>路由出发Free事件</p> <div class="language-php extra-class"><pre class="language-php"><code>Route<span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token single-quoted-string string">'/free'</span><span class="token punctuation">,</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token function">event</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name"><span class="token punctuation">\</span>App<span class="token punctuation">\</span>Events<span class="token punctuation">\</span>Free</span><span class="token punctuation">(</span><span class="token double-quoted-string string">&quot;Hello OrangBus&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">dd</span><span class="token punctuation">(</span><span class="token double-quoted-string string">&quot;ok&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>接听消息</p> <div class="language-html extra-class"><pre class="language-html"><code><span class="token doctype">&lt;!doctype html&gt;</span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>html</span> <span class="token attr-name">lang</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>en<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>head</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>meta</span> <span class="token attr-name">charset</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>UTF-8<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>meta</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>viewport<span class="token punctuation">&quot;</span></span>
          <span class="token attr-name">content</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>width=device-width, user-scalable=no, initial-scale=1.0, maximum-scale=1.0, minimum-scale=1.0<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>meta</span> <span class="token attr-name">http-equiv</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>X-UA-Compatible<span class="token punctuation">&quot;</span></span> <span class="token attr-name">content</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>ie=edge<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>meta</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>csrf-token<span class="token punctuation">&quot;</span></span> <span class="token attr-name">content</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>{{ csrf_token() }}<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
    &lt;link rel=&quot;stylesheet&quot; href=&quot;{{ mix(&quot;css/app.css&quot;) }}&quot;&gt;
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>title</span><span class="token punctuation">&gt;</span></span>Document<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>title</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>head</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>body</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>app<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>h1</span><span class="token punctuation">&gt;</span></span>pusher<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>h1</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>

&lt;script src=&quot;{{ mix(&quot;js/app.js&quot;) }}&quot;&gt;<span class="token script"></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span><span class="token punctuation">&gt;</span></span><span class="token script"><span class="token language-javascript">
    window<span class="token punctuation">.</span>Echo<span class="token punctuation">.</span><span class="token function">channel</span><span class="token punctuation">(</span><span class="token string">'cctv1'</span><span class="token punctuation">)</span>
        <span class="token punctuation">.</span><span class="token function">listen</span><span class="token punctuation">(</span><span class="token string">'Free'</span><span class="token punctuation">,</span> <span class="token parameter">e</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
            console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>body</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>html</span><span class="token punctuation">&gt;</span></span>
</code></pre></div><p>如果按照上面的步骤跑完了没有监听到数据：</p> <p>1、pusher推动延迟了，等一会或者多刷新几次</p> <p>2、pusher配置哪里出错了</p> <h2 id="laravel8广播-websocket"><a href="#laravel8广播-websocket" class="header-anchor">#</a> laravel8广播+websocket</h2> <h3 id="安装laravel-和前端脚手架"><a href="#安装laravel-和前端脚手架" class="header-anchor">#</a> 安装laravel 和前端脚手架</h3> <div class="language-bash extra-class"><pre class="language-bash"><code>laravel new websocket

// laravel8新出的（不会用）
composer require laravel/jetstream

php artisan jetstream:install livewire // blade模板
php artisan jetstream:install inertia //vue模板

// 可以使用脚手架
composer require laravel/ui --dev

// 生成基本脚手架<span class="token punctuation">..</span>.
php artisan ui bootstrap
php artisan ui vue
php artisan ui react

// 生成 登陆/注册 脚手架<span class="token punctuation">..</span>.
php artisan ui bootstrap --auth
php artisan ui vue --auth
php artisan ui react --auth

<span class="token function">npm</span> i <span class="token operator">&amp;&amp;</span> <span class="token function">npm</span> run dev

// 热加载 webpack.mix.js
mix.browserSync<span class="token punctuation">(</span><span class="token string">'redis.test'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>配置数据库并迁移数据库文件</p> <div class="language-bash extra-class"><pre class="language-bash"><code>php artisan migrate
</code></pre></div><p>先让项目跑起来看看有没有报错，能否正常注册</p> <div class="language-bash extra-class"><pre class="language-bash"><code>php artisan serve
</code></pre></div><h3 id="安装-laravel-websocket"><a href="#安装-laravel-websocket" class="header-anchor">#</a> 安装 <code>laravel/websocket</code></h3> <blockquote><p>https://beyondco.de/</p></blockquote> <p>用过laravel的朋友因该都熟悉下面的操作吧</p> <div class="language-bash extra-class"><pre class="language-bash"><code>composer require beyondcode/laravel-websockets
</code></pre></div><div class="language-bash extra-class"><pre class="language-bash"><code>php artisan vendor:publish --provider<span class="token operator">=</span><span class="token string">&quot;BeyondCode\LaravelWebSockets\WebSocketsServiceProvider&quot;</span> --tag<span class="token operator">=</span><span class="token string">&quot;migrations&quot;</span>
</code></pre></div><div class="language-bash extra-class"><pre class="language-bash"><code>php artisan vendor:publish --provider<span class="token operator">=</span><span class="token string">&quot;BeyondCode\LaravelWebSockets\WebSocketsServiceProvider&quot;</span> --tag<span class="token operator">=</span><span class="token string">&quot;config&quot;</span>
</code></pre></div><div class="language-bash extra-class"><pre class="language-bash"><code>php artisan migrate
</code></pre></div><h3 id="安装-pusher"><a href="#安装-pusher" class="header-anchor">#</a> 安装 <code>pusher</code></h3> <p>注册一个pusher账号，获取api信息：https://pusher.com/</p> <div class="language- extra-class"><pre class="language-text"><code>composer require pusher/pusher-php-server &quot;~3.0&quot;
</code></pre></div><p>修改 <code>.env</code></p> <div class="language- extra-class"><pre class="language-text"><code>BROADCAST_DRIVER=pusher
</code></pre></div><p>修改 <code>config/broadcasting.php</code> （记得要配置这里，不然接受不到消息）</p> <div class="language-php extra-class"><pre class="language-php"><code><span class="token single-quoted-string string">'pusher'</span> <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token punctuation">[</span>
    <span class="token single-quoted-string string">'driver'</span> <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token single-quoted-string string">'pusher'</span><span class="token punctuation">,</span>
    <span class="token single-quoted-string string">'key'</span> <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token function">env</span><span class="token punctuation">(</span><span class="token single-quoted-string string">'PUSHER_APP_KEY'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token single-quoted-string string">'secret'</span> <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token function">env</span><span class="token punctuation">(</span><span class="token single-quoted-string string">'PUSHER_APP_SECRET'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token single-quoted-string string">'app_id'</span> <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token function">env</span><span class="token punctuation">(</span><span class="token single-quoted-string string">'PUSHER_APP_ID'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token single-quoted-string string">'options'</span> <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token punctuation">[</span> 
        <span class="token single-quoted-string string">'cluster'</span> <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token function">env</span><span class="token punctuation">(</span><span class="token single-quoted-string string">'PUSHER_APP_CLUSTER'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
        <span class="token single-quoted-string string">'encrypted'</span> <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token boolean constant">true</span><span class="token punctuation">,</span>
        <span class="token single-quoted-string string">'host'</span> <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token single-quoted-string string">'127.0.0.1'</span><span class="token punctuation">,</span>
        <span class="token single-quoted-string string">'port'</span> <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token number">6001</span><span class="token punctuation">,</span>
        <span class="token single-quoted-string string">'scheme'</span> <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token single-quoted-string string">'http'</span>
    <span class="token punctuation">]</span><span class="token punctuation">,</span>
<span class="token punctuation">]</span><span class="token punctuation">,</span>
</code></pre></div><p>修改 <code>config/websockets.php</code></p> <div class="language-php extra-class"><pre class="language-php"><code><span class="token single-quoted-string string">'apps'</span> <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token punctuation">[</span>
    <span class="token punctuation">[</span>
        <span class="token single-quoted-string string">'id'</span> <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token function">env</span><span class="token punctuation">(</span><span class="token single-quoted-string string">'PUSHER_APP_ID'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
        <span class="token single-quoted-string string">'name'</span> <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token function">env</span><span class="token punctuation">(</span><span class="token single-quoted-string string">'APP_NAME'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
        <span class="token single-quoted-string string">'key'</span> <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token function">env</span><span class="token punctuation">(</span><span class="token single-quoted-string string">'PUSHER_APP_KEY'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
        <span class="token single-quoted-string string">'secret'</span> <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token function">env</span><span class="token punctuation">(</span><span class="token single-quoted-string string">'PUSHER_APP_SECRET'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
        <span class="token single-quoted-string string">'enable_client_messages'</span> <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token boolean constant">false</span><span class="token punctuation">,</span>
        <span class="token single-quoted-string string">'enable_statistics'</span> <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token boolean constant">true</span><span class="token punctuation">,</span>
    <span class="token punctuation">]</span><span class="token punctuation">,</span>
<span class="token punctuation">]</span><span class="token punctuation">,</span>
</code></pre></div><p>启动 laravel-websocket 服务</p> <div class="language- extra-class"><pre class="language-text"><code>php artisan websockets:serve //默认6001
// or
php artisan websockets:serve --port=3030
</code></pre></div><p>查看<strong>websocket dashboard</strong>：<code>ip/laravel-websockets</code></p> <p>你可以配置<strong>websocket dashboard</strong>访问权限：<code>AuthServiceProvider</code></p> <div class="language-php extra-class"><pre class="language-php"><code><span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function">boot</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">registerPolicies</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    Gate<span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token function">define</span><span class="token punctuation">(</span><span class="token single-quoted-string string">'viewWebSocketsDashboard'</span><span class="token punctuation">,</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token variable">$user</span> <span class="token operator">=</span> <span class="token constant">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token function">in_array</span><span class="token punctuation">(</span><span class="token variable">$user</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token property">email</span><span class="token punctuation">,</span> <span class="token punctuation">[</span>
            <span class="token comment">//</span>
        <span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><h3 id="安装前端库"><a href="#安装前端库" class="header-anchor">#</a> 安装前端库</h3> <div class="language-bash extra-class"><pre class="language-bash"><code><span class="token function">npm</span> <span class="token function">install</span> --save laravel-echo pusher-js
<span class="token function">npm</span> <span class="token function">install</span> --save socket.io-client
</code></pre></div><h3 id="创建事件"><a href="#创建事件" class="header-anchor">#</a> 创建事件</h3> <div class="language-php extra-class"><pre class="language-php"><code>php artisan make<span class="token punctuation">:</span>event WeChat
</code></pre></div><p>在<code>app/Events/Wechat</code> 实现广播接口</p> <div class="language-php extra-class"><pre class="language-php"><code><span class="token php language-php"><span class="token delimiter important">&lt;?php</span>

<span class="token keyword">namespace</span> <span class="token package">App<span class="token punctuation">\</span>Events</span><span class="token punctuation">;</span>

<span class="token keyword">use</span> <span class="token package">Illuminate<span class="token punctuation">\</span>Broadcasting<span class="token punctuation">\</span>Channel</span><span class="token punctuation">;</span>
<span class="token keyword">use</span> <span class="token package">Illuminate<span class="token punctuation">\</span>Broadcasting<span class="token punctuation">\</span>InteractsWithSockets</span><span class="token punctuation">;</span>
<span class="token keyword">use</span> <span class="token package">Illuminate<span class="token punctuation">\</span>Broadcasting<span class="token punctuation">\</span>PresenceChannel</span><span class="token punctuation">;</span>
<span class="token keyword">use</span> <span class="token package">Illuminate<span class="token punctuation">\</span>Broadcasting<span class="token punctuation">\</span>PrivateChannel</span><span class="token punctuation">;</span>
<span class="token keyword">use</span> <span class="token package">Illuminate<span class="token punctuation">\</span>Contracts<span class="token punctuation">\</span>Broadcasting<span class="token punctuation">\</span>ShouldBroadcast</span><span class="token punctuation">;</span>
<span class="token keyword">use</span> <span class="token package">Illuminate<span class="token punctuation">\</span>Foundation<span class="token punctuation">\</span>Events<span class="token punctuation">\</span>Dispatchable</span><span class="token punctuation">;</span>
<span class="token keyword">use</span> <span class="token package">Illuminate<span class="token punctuation">\</span>Queue<span class="token punctuation">\</span>SerializesModels</span><span class="token punctuation">;</span>

<span class="token keyword">class</span> <span class="token class-name">WeChat</span> <span class="token keyword">implements</span> <span class="token class-name">ShouldBroadcast</span>
<span class="token punctuation">{</span>
    <span class="token keyword">use</span> <span class="token package">Dispatchable</span><span class="token punctuation">,</span> InteractsWithSockets<span class="token punctuation">,</span> SerializesModels<span class="token punctuation">;</span>
    
    <span class="token keyword">public</span> <span class="token variable">$msg</span><span class="token punctuation">;</span>
    <span class="token keyword">public</span> <span class="token variable">$user</span><span class="token punctuation">;</span>

    <span class="token comment">/**
     * Create a new event instance.
     *
     * @return void
     */</span>
    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function">__construct</span><span class="token punctuation">(</span><span class="token variable">$msg</span><span class="token punctuation">,</span><span class="token variable">$user</span><span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token property">msg</span> <span class="token operator">=</span> <span class="token variable">$msg</span><span class="token punctuation">;</span>
        <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token property">user</span> <span class="token operator">=</span> <span class="token variable">$user</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token comment">/**
     * Get the channels the event should broadcast on.
     *
     * @return \Illuminate\Broadcasting\Channel|array
     */</span>
    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function">broadcastOn</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">Channel</span><span class="token punctuation">(</span><span class="token single-quoted-string string">'cctv1'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

</span></code></pre></div><p><code>Wechat</code>:  事件的名称</p> <p><code>cctv1</code>:  频道的名称</p> <p>注册一个事件触发的路由</p> <div class="language-php extra-class"><pre class="language-php"><code>Route<span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token double-quoted-string string">&quot;/chat&quot;</span><span class="token punctuation">,</span><span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token variable">$msg</span> <span class="token operator">=</span> <span class="token function">request</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">input</span><span class="token punctuation">(</span><span class="token double-quoted-string string">&quot;msg&quot;</span><span class="token punctuation">,</span><span class="token double-quoted-string string">&quot;orangbus&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token variable">$user</span> <span class="token operator">=</span> \<span class="token package">Illuminate<span class="token punctuation">\</span>Support<span class="token punctuation">\</span>Facades<span class="token punctuation">\</span>Auth</span><span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token function">user</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">event</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name"><span class="token punctuation">\</span>App<span class="token punctuation">\</span>Events<span class="token punctuation">\</span>Wechat</span><span class="token punctuation">(</span><span class="token variable">$msg</span><span class="token punctuation">,</span><span class="token variable">$user</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">dd</span><span class="token punctuation">(</span><span class="token variable">$msg</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>监听事件:<code>bootstrap</code> （不要忘记了在视图页面加载 <code>app.css</code> 和 <code>app.js</code>文件）</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">import</span> Echo <span class="token keyword">from</span> <span class="token string">'laravel-echo'</span><span class="token punctuation">;</span>

window<span class="token punctuation">.</span>Pusher <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'pusher-js'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

window<span class="token punctuation">.</span>Echo <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Echo</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
    broadcaster<span class="token operator">:</span> <span class="token string">'pusher'</span><span class="token punctuation">,</span>
    key<span class="token operator">:</span> process<span class="token punctuation">.</span>env<span class="token punctuation">.</span><span class="token constant">MIX_PUSHER_APP_KEY</span><span class="token punctuation">,</span> <span class="token comment">//把 .env文件的信息复制过来</span>
    cluster<span class="token operator">:</span> process<span class="token punctuation">.</span>env<span class="token punctuation">.</span><span class="token constant">MIX_PUSHER_APP_CLUSTER</span><span class="token punctuation">,</span> <span class="token comment">//把 .env文件的信息复制过来</span>
    forceTLS<span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>
    wsHost<span class="token operator">:</span> <span class="token string">'127.0.0.1'</span><span class="token punctuation">,</span>
    wsPort<span class="token operator">:</span> <span class="token number">6001</span><span class="token punctuation">,</span>
    <span class="token comment">// wsPath: '/ws',</span>
    disableStats<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
    enabledTransports<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">'ws'</span><span class="token punctuation">,</span><span class="token string">'wss'</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token comment">//如果你的消息发送失败多半是因为这个</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">//我们就可以接收到如下消息</span>
<span class="token punctuation">{</span>
  <span class="token string">&quot;msg&quot;</span><span class="token operator">:</span> <span class="token string">&quot;orangbus&quot;</span><span class="token punctuation">,</span>
  <span class="token string">&quot;user&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token string">&quot;id&quot;</span><span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">,</span>
    <span class="token string">&quot;name&quot;</span><span class="token operator">:</span> <span class="token string">&quot;orangbus&quot;</span><span class="token punctuation">,</span>
    <span class="token string">&quot;email&quot;</span><span class="token operator">:</span> <span class="token string">&quot;123@qq.com&quot;</span><span class="token punctuation">,</span>
    <span class="token string">&quot;email_verified_at&quot;</span><span class="token operator">:</span> <span class="token keyword">null</span><span class="token punctuation">,</span>
    <span class="token string">&quot;created_at&quot;</span><span class="token operator">:</span> <span class="token string">&quot;2020-12-04T09:01:47.000000Z&quot;</span><span class="token punctuation">,</span>
    <span class="token string">&quot;updated_at&quot;</span><span class="token operator">:</span> <span class="token string">&quot;2020-12-04T09:01:47.000000Z&quot;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><h2 id="laravel8广播-redis"><a href="#laravel8广播-redis" class="header-anchor">#</a> laravel8广播-redis</h2> <h3 id="安装redis广播库"><a href="#安装redis广播库" class="header-anchor">#</a> 安装redis广播库</h3> <div class="language-bash extra-class"><pre class="language-bash"><code>composer require predis/predis
</code></pre></div><h3 id="安装前端依赖"><a href="#安装前端依赖" class="header-anchor">#</a> 安装前端依赖</h3> <div class="language-bash extra-class"><pre class="language-bash"><code><span class="token function">npm</span> <span class="token function">install</span> --save socket.io-client
<span class="token function">npm</span> <span class="token function">install</span> --save laravel-echo pusher-js
<span class="token function">npm</span> <span class="token function">install</span> -g laravel-echo-server

<span class="token function">npm</span> i <span class="token operator">&amp;&amp;</span> <span class="token function">npm</span> run <span class="token function">watch</span>

laravel-echo-server init
laravel-echo-server start
</code></pre></div><p>在入口文件中添加这个 <code>socket.io</code></p> <div class="language-javascript extra-class"><pre class="language-javascript"><code> <span class="token operator">&lt;</span>script src<span class="token operator">=</span><span class="token string">&quot;//{{ Request::getHost() }}:6001/socket.io/socket.io.js&quot;</span><span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">/</span>script<span class="token operator">&gt;</span>
</code></pre></div><p>修改<code>.env</code></p> <div class="language-env extra-class"><pre class="language-text"><code>BROADCAST_DRIVER=redis
CACHE_DRIVER=file
QUEUE_CONNECTION=sync
</code></pre></div><h3 id="开启广播"><a href="#开启广播" class="header-anchor">#</a> 开启广播</h3> <p>config/app.php 的 providers取消注释</p> <div class="language-php extra-class"><pre class="language-php"><code>App\<span class="token package">Providers<span class="token punctuation">\</span>BroadcastServiceProvider</span><span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token keyword">class</span><span class="token punctuation">,</span>
</code></pre></div><h3 id="创建一个公有广播事件"><a href="#创建一个公有广播事件" class="header-anchor">#</a> 创建一个公有广播事件</h3> <div class="language-bash extra-class"><pre class="language-bash"><code>php artisan make:event Free
</code></pre></div><div class="language-php extra-class"><pre class="language-php"><code><span class="token php language-php"><span class="token delimiter important">&lt;?php</span>

<span class="token keyword">namespace</span> <span class="token package">App<span class="token punctuation">\</span>Events</span><span class="token punctuation">;</span>

<span class="token keyword">use</span> <span class="token package">Illuminate<span class="token punctuation">\</span>Broadcasting<span class="token punctuation">\</span>Channel</span><span class="token punctuation">;</span>
<span class="token keyword">use</span> <span class="token package">Illuminate<span class="token punctuation">\</span>Broadcasting<span class="token punctuation">\</span>InteractsWithSockets</span><span class="token punctuation">;</span>
<span class="token keyword">use</span> <span class="token package">Illuminate<span class="token punctuation">\</span>Broadcasting<span class="token punctuation">\</span>PresenceChannel</span><span class="token punctuation">;</span>
<span class="token keyword">use</span> <span class="token package">Illuminate<span class="token punctuation">\</span>Broadcasting<span class="token punctuation">\</span>PrivateChannel</span><span class="token punctuation">;</span>
<span class="token keyword">use</span> <span class="token package">Illuminate<span class="token punctuation">\</span>Contracts<span class="token punctuation">\</span>Broadcasting<span class="token punctuation">\</span>ShouldBroadcast</span><span class="token punctuation">;</span>
<span class="token keyword">use</span> <span class="token package">Illuminate<span class="token punctuation">\</span>Foundation<span class="token punctuation">\</span>Events<span class="token punctuation">\</span>Dispatchable</span><span class="token punctuation">;</span>
<span class="token keyword">use</span> <span class="token package">Illuminate<span class="token punctuation">\</span>Queue<span class="token punctuation">\</span>SerializesModels</span><span class="token punctuation">;</span>

<span class="token keyword">class</span> <span class="token class-name">Free</span> <span class="token keyword">implements</span> <span class="token class-name">ShouldBroadcast</span> <span class="token comment">//实现广播接口</span>
<span class="token punctuation">{</span>
    <span class="token keyword">use</span> <span class="token package">Dispatchable</span><span class="token punctuation">,</span> InteractsWithSockets<span class="token punctuation">,</span> SerializesModels<span class="token punctuation">;</span>
    
    <span class="token keyword">public</span> <span class="token variable">$msg</span><span class="token punctuation">;</span>

    <span class="token comment">/**
     * Create a new event instance.
     *
     * @return void
     */</span>
    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function">__construct</span><span class="token punctuation">(</span><span class="token variable">$msg</span><span class="token punctuation">)</span> <span class="token comment">//触发时间传递过来的参数</span>
    <span class="token punctuation">{</span>
        <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token property">msg</span> <span class="token operator">=</span> <span class="token variable">$msg</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token comment">/**
     * Get the channels the event should broadcast on.
     *
     * @return \Illuminate\Broadcasting\Channel|array
     */</span>
    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function">broadcastOn</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">Channel</span><span class="token punctuation">(</span><span class="token single-quoted-string string">'cctv'</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//频道的名称</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

</span></code></pre></div><h4 id="添加一条路由触发事件"><a href="#添加一条路由触发事件" class="header-anchor">#</a> 添加一条路由触发事件</h4> <div class="language-php extra-class"><pre class="language-php"><code>Route<span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token function">any</span><span class="token punctuation">(</span><span class="token single-quoted-string string">'/free'</span><span class="token punctuation">,</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token variable">$msg</span> <span class="token operator">=</span> <span class="token function">request</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">input</span><span class="token punctuation">(</span><span class="token double-quoted-string string">&quot;msg&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">event</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name"><span class="token punctuation">\</span>App<span class="token punctuation">\</span>Events<span class="token punctuation">\</span>Free</span><span class="token punctuation">(</span><span class="token variable">$msg</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> <span class="token variable">$msg</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h4 id="监听事件"><a href="#监听事件" class="header-anchor">#</a> 监听事件</h4> <p>记得在入口文件处添加header头</p> <div class="language-html extra-class"><pre class="language-html"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>meta</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>csrf-token<span class="token punctuation">&quot;</span></span> <span class="token attr-name">content</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>{{ csrf_token() }}<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
</code></pre></div><div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">//resources/js/bootstrap.js</span>
<span class="token keyword">import</span> Echo <span class="token keyword">from</span> <span class="token string">&quot;laravel-echo&quot;</span><span class="token punctuation">;</span>

<span class="token comment">// window.io = require('socket.io-client'); //按照官网的意思需要加上，可是我加上了却监听不到消息，搞了好多天无意间注释了反而接收到消息了，有没有大佬告知一下为什么？？</span>

window<span class="token punctuation">.</span>Echo <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Echo</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
    broadcaster<span class="token operator">:</span> <span class="token string">'socket.io'</span><span class="token punctuation">,</span>
    host<span class="token operator">:</span> window<span class="token punctuation">.</span>location<span class="token punctuation">.</span>hostname <span class="token operator">+</span> <span class="token string">':6001'</span> <span class="token comment">//如果需要单独写其他域名不用加http，</span>
    <span class="token comment">// host: &quot;redis.test:6001&quot;</span>
    <span class="token comment">//可选</span>
    auth<span class="token operator">:</span> <span class="token punctuation">{</span>
    headers<span class="token operator">:</span> <span class="token punctuation">{</span>
      Authorization<span class="token operator">:</span> <span class="token string">&quot;Bearer &quot;</span> <span class="token operator">+</span> Cookies<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">'access_token'</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

window<span class="token punctuation">.</span>Echo<span class="token punctuation">.</span><span class="token function">channel</span><span class="token punctuation">(</span><span class="token string">'cctv'</span><span class="token punctuation">)</span> <span class="token comment">//频道的名称</span>
    <span class="token punctuation">.</span><span class="token function">listen</span><span class="token punctuation">(</span><span class="token string">'Free'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">e</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span> <span class="token comment">// 监听的事件</span>
        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;这里是接受到的消息&quot;</span><span class="token punctuation">)</span>
        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h3 id="私有广播事件"><a href="#私有广播事件" class="header-anchor">#</a> 私有广播事件</h3> <p>先登录一个账号，私有广播需要权限认证</p> <h4 id="创建一个广播事件"><a href="#创建一个广播事件" class="header-anchor">#</a> 创建一个广播事件</h4> <div class="language-bash extra-class"><pre class="language-bash"><code>php artisan make:event LetChat
</code></pre></div><div class="language-php extra-class"><pre class="language-php"><code><span class="token php language-php"><span class="token delimiter important">&lt;?php</span>

<span class="token keyword">namespace</span> <span class="token package">App<span class="token punctuation">\</span>Events</span><span class="token punctuation">;</span>

<span class="token keyword">use</span> <span class="token package">Illuminate<span class="token punctuation">\</span>Broadcasting<span class="token punctuation">\</span>Channel</span><span class="token punctuation">;</span>
<span class="token keyword">use</span> <span class="token package">Illuminate<span class="token punctuation">\</span>Broadcasting<span class="token punctuation">\</span>InteractsWithSockets</span><span class="token punctuation">;</span>
<span class="token keyword">use</span> <span class="token package">Illuminate<span class="token punctuation">\</span>Broadcasting<span class="token punctuation">\</span>PresenceChannel</span><span class="token punctuation">;</span>
<span class="token keyword">use</span> <span class="token package">Illuminate<span class="token punctuation">\</span>Broadcasting<span class="token punctuation">\</span>PrivateChannel</span><span class="token punctuation">;</span>
<span class="token keyword">use</span> <span class="token package">Illuminate<span class="token punctuation">\</span>Contracts<span class="token punctuation">\</span>Broadcasting<span class="token punctuation">\</span>ShouldBroadcast</span><span class="token punctuation">;</span>
<span class="token keyword">use</span> <span class="token package">Illuminate<span class="token punctuation">\</span>Foundation<span class="token punctuation">\</span>Events<span class="token punctuation">\</span>Dispatchable</span><span class="token punctuation">;</span>
<span class="token keyword">use</span> <span class="token package">Illuminate<span class="token punctuation">\</span>Queue<span class="token punctuation">\</span>SerializesModels</span><span class="token punctuation">;</span>

<span class="token keyword">class</span> <span class="token class-name">LetChat</span> <span class="token keyword">implements</span> <span class="token class-name">ShouldBroadcast</span> <span class="token comment">//事件广播接口</span>
<span class="token punctuation">{</span>
    <span class="token keyword">use</span> <span class="token package">Dispatchable</span><span class="token punctuation">,</span> InteractsWithSockets<span class="token punctuation">,</span> SerializesModels<span class="token punctuation">;</span>
 
    <span class="token keyword">public</span> <span class="token variable">$msg</span><span class="token punctuation">;</span> <span class="token comment">//前端传递过来的数据</span>
    <span class="token keyword">public</span> <span class="token variable">$user_id</span><span class="token punctuation">;</span> <span class="token comment">//假如传递一个用户ID</span>

    <span class="token comment">/**
     * Create a new event instance.
     *
     * @return void
     */</span>
    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function">__construct</span><span class="token punctuation">(</span><span class="token variable">$msg</span><span class="token punctuation">,</span><span class="token variable">$user_id</span><span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token property">msg</span> <span class="token operator">=</span> <span class="token variable">$msg</span><span class="token punctuation">;</span>
        <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token property">user_id</span> <span class="token operator">=</span> <span class="token variable">$user_id</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token comment">/**
     * Get the channels the event should broadcast on.
     *
     * @return \Illuminate\Broadcasting\Channel|array
     */</span>
    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function">broadcastOn</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">PrivateChannel</span><span class="token punctuation">(</span><span class="token single-quoted-string string">'cctv.'</span><span class="token punctuation">.</span><span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token property">user_id</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 这里是一个私有的广播，频道的名称大概是这样的： cctv.1</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

</span></code></pre></div><h4 id="添加一个触发路由"><a href="#添加一个触发路由" class="header-anchor">#</a> 添加一个触发路由</h4> <div class="language-php extra-class"><pre class="language-php"><code>Route<span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token function">any</span><span class="token punctuation">(</span><span class="token single-quoted-string string">'/free'</span><span class="token punctuation">,</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token variable">$msg</span> <span class="token operator">=</span> <span class="token function">request</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">input</span><span class="token punctuation">(</span><span class="token double-quoted-string string">&quot;msg&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token variable">$userId</span> <span class="token operator">=</span> Auth<span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token function">id</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">event</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name"><span class="token punctuation">\</span>App<span class="token punctuation">\</span>Events<span class="token punctuation">\</span>Free</span><span class="token punctuation">(</span><span class="token variable">$msg</span><span class="token punctuation">,</span><span class="token variable">$userId</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> <span class="token variable">$msg</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">middleware</span><span class="token punctuation">(</span><span class="token double-quoted-string string">&quot;auth&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 用户需要登录</span>
</code></pre></div><h4 id="权限认证"><a href="#权限认证" class="header-anchor">#</a> 权限认证</h4> <p>这个文件跟 <code>routes/web</code> 路由是类似的，只有返回 <code>true</code> 的时候才会进行广播事件，所以我们可以在这里进行一些逻辑上的判断</p> <div class="language-php extra-class"><pre class="language-php"><code><span class="token comment">// routes/channels</span>
Broadcast<span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token function">channel</span><span class="token punctuation">(</span><span class="token single-quoted-string string">'cctv.{id}'</span><span class="token punctuation">,</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token variable">$id</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// 写一些判断逻辑，最终返回true即可</span>
    <span class="token variable">$list</span> <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token number">3</span><span class="token punctuation">,</span><span class="token number">4</span><span class="token punctuation">,</span><span class="token number">5</span><span class="token punctuation">,</span><span class="token number">6</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">in_array</span><span class="token punctuation">(</span><span class="token variable">$id</span><span class="token punctuation">,</span><span class="token variable">$list</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token keyword">return</span> <span class="token boolean constant">true</span><span class="token punctuation">;</span> <span class="token comment">//当传过来的用户id在 $list 这个才会进行广播</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h4 id="前端监听事件"><a href="#前端监听事件" class="header-anchor">#</a> 前端监听事件</h4> <div class="language-js extra-class"><pre class="language-js"><code>
</code></pre></div><h3 id="广播使用redis"><a href="#广播使用redis" class="header-anchor">#</a> 广播使用redis</h3> <div class="language-env extra-class"><pre class="language-text"><code>BROADCAST_DRIVER=redis
CACHE_DRIVER=redis
QUEUE_CONNECTION=redis
</code></pre></div><p>需要运行队列监听</p> <div class="language-bash extra-class"><pre class="language-bash"><code>php artisan queue:listen
</code></pre></div><h2 id="laravel广播-redis-laradock"><a href="#laravel广播-redis-laradock" class="header-anchor">#</a> laravel广播+redis+laradock</h2> <p>启动<code>laravel-echo-serve</code></p> <div class="language-bash extra-class"><pre class="language-bash"><code><span class="token builtin class-name">cd</span> pathTo/laradock
docker-composer up -d redis laravel-echo-serve
</code></pre></div><p>默认就开始了 6001端口，这样我们就可以连接了</p> <h2 id="laradock-laravel-redis广播"><a href="#laradock-laravel-redis广播" class="header-anchor">#</a> Laradock+Laravel+redis广播</h2> <div class="language-bash extra-class"><pre class="language-bash"><code>laravel new webscoket

composer require predis/predis

composer require laravel/ui --dev
php artisan ui vue --auth

<span class="token function">npm</span> <span class="token function">install</span> --save socket.io-client <span class="token operator">|</span>  <span class="token builtin class-name">echo</span> <span class="token string">'websocket 客户端'</span>
<span class="token function">npm</span> <span class="token function">install</span> --save laravel-echo     <span class="token operator">|</span>  <span class="token builtin class-name">echo</span> <span class="token string">'websocket 客户端封装'</span>
<span class="token function">npm</span> <span class="token function">install</span> -g laravel-echo-server  <span class="token operator">|</span>  <span class="token builtin class-name">echo</span> <span class="token string">'websocket 服务端'</span>
<span class="token function">npm</span> <span class="token function">install</span>                         <span class="token operator">|</span>  <span class="token builtin class-name">echo</span> <span class="token string">'安装所有其他依赖'</span>
<span class="token function">npm</span> run <span class="token function">watch</span>                        <span class="token operator">|</span>  <span class="token builtin class-name">echo</span> <span class="token string">'监控文件变化编译前端资源'</span>
laravel-echo-server init             <span class="token operator">|</span>  <span class="token builtin class-name">echo</span> <span class="token string">'初始化 websocket 服务端'</span>
laravel-echo-server start            <span class="token operator">|</span>  <span class="token builtin class-name">echo</span> <span class="token string">'启动 websocket 服务端'</span>

// 热加载 webpack.mix.js
mix.browserSync<span class="token punctuation">(</span><span class="token string">'redis.test'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
cnpm <span class="token function">install</span> browser-sync browser-sync-webpack-plugin@2.0.1 --save-dev --production<span class="token operator">=</span>false

</code></pre></div><p>.env 文件配置</p> <div class="language-env extra-class"><pre class="language-text"><code>BROADCAST_DRIVER=redis
CACHE_DRIVER=redis
QUEUE_CONNECTION=redis
</code></pre></div><h3 id="注意事项"><a href="#注意事项" class="header-anchor">#</a> 注意事项</h3> <p>1、使用 <code>php-worker</code> 的时候，需要开启redis扩展。</p> <p>2、最好把 <code>workspace</code> 的PHP 的 redis 扩展也安装了。</p></div> <footer class="page-edit"><div class="edit-link"><a href="https://github.com/super-eggs/vuepress-blog/edit/master/docs/Code/LaraCode.md" target="_blank" rel="noopener noreferrer">帮助我们改善此页面！</a> <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></div> <!----></footer> <!----> </main></div><div class="global-ui"><!----><div class="reading-progress top" data-v-21b39eda><div class="progress" data-v-21b39eda></div></div></div></div>
    <script src="/assets/js/app.693e6c19.js" defer></script><script src="/assets/js/2.3304c2e1.js" defer></script><script src="/assets/js/8.51a4d2f9.js" defer></script>
  </body>
</html>
