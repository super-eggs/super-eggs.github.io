(window.webpackJsonp=window.webpackJsonp||[]).push([[55],{418:function(t,s,a){"use strict";a.r(s);var e=a(11),r=Object(e.a)({},(function(){var t=this,s=t.$createElement,a=t._self._c||s;return a("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[a("h1",{attrs:{id:"deployer-部署工具"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#deployer-部署工具"}},[t._v("#")]),t._v(" Deployer 部署工具")]),t._v(" "),a("h2",{attrs:{id:"介绍"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#介绍"}},[t._v("#")]),t._v(" 介绍")]),t._v(" "),a("p",[t._v("Deployer 是一个使用 PHP 开发的轻量级项目部署工具，Deployer 不需要在目标服务器上安装任何客户端即可使用，它的原理是通过 SSH 登录到目标服务器，然后执行脚本中定义好的 Shell 命令。")]),t._v(" "),a("p",[t._v("同时 Deployer 内置了一批常见项目、框架的部署脚本，例如 Laravel、WordPress 等等，当我们需要部署相关项目时，只需要调整一些参数就可以直接使用。")]),t._v(" "),a("p",[a("a",{attrs:{href:"https://deployer.org/",target:"_blank",rel:"noopener noreferrer"}},[t._v("官网文档"),a("OutboundLink")],1)]),t._v(" "),a("h2",{attrs:{id:"安装"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#安装"}},[t._v("#")]),t._v(" 安装")]),t._v(" "),a("p",[t._v("安装部署器有三种方法：")]),t._v(" "),a("ol",[a("li",[t._v("下载 phar 存档")]),t._v(" "),a("li",[t._v("Composer 安装")]),t._v(" "),a("li",[t._v("局部 Composer 安装")])]),t._v(" "),a("h3",{attrs:{id:"下载-phar-存档"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#下载-phar-存档"}},[t._v("#")]),t._v(" 下载 phar 存档")]),t._v(" "),a("p",[t._v("要将部署器安装为 phar 存档，运行以下命令：")]),t._v(" "),a("div",{staticClass:"language-sh extra-class"},[a("pre",{pre:!0,attrs:{class:"language-sh"}},[a("code",[a("span",{pre:!0,attrs:{class:"token function"}},[t._v("curl")]),t._v(" -LO https://deployer.org/deployer.phar\n"),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("mv")]),t._v(" deployer.phar /usr/local/bin/dep\n"),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("chmod")]),t._v(" +x /usr/local/bin/dep\n")])])]),a("p",[t._v("如果您需要另一个版本的 Deployer，您可以在"),a("a",{attrs:{href:"https://deployer.org/download",target:"_blank",rel:"noopener noreferrer"}},[t._v("下载页面"),a("OutboundLink")],1),t._v("上找到它。稍后，要升级 Deployer，运行命令：")]),t._v(" "),a("div",{staticClass:"language-bash extra-class"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[t._v("dep self-update\n")])])]),a("p",[t._v("要升级到下一个主要版本（如果可用），请使用该选项："),a("code",[t._v("--upgrade (-u)")])]),t._v(" "),a("div",{staticClass:"language-sh extra-class"},[a("pre",{pre:!0,attrs:{class:"language-sh"}},[a("code",[t._v("dep self-update --upgrade\n")])])]),a("h3",{attrs:{id:"composer-安装"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#composer-安装"}},[t._v("#")]),t._v(" composer 安装")]),t._v(" "),a("p",[t._v("要将 Deployer 源版本与 composer 一起安装，运行命令：")]),t._v(" "),a("div",{staticClass:"language-sh extra-class"},[a("pre",{pre:!0,attrs:{class:"language-sh"}},[a("code",[t._v("composer require deployer/deployer --dev\n")])])]),a("p",[t._v("您也可以在全局范围内安装它：")]),t._v(" "),a("div",{staticClass:"language-sh extra-class"},[a("pre",{pre:!0,attrs:{class:"language-sh"}},[a("code",[t._v("composer global require deployer/deployer\n")])])]),a("blockquote",[a("p",[t._v("如果之前已经安装过 deployer，请再次执行这个命令以更新到最新版。")])]),t._v(" "),a("p",[t._v("更多信息： https://getcomposer.org/doc/03-cli.md#global")]),t._v(" "),a("p",[t._v("然后要使用 Deployer，请运行以下命令：")]),t._v(" "),a("div",{staticClass:"language-sh extra-class"},[a("pre",{pre:!0,attrs:{class:"language-sh"}},[a("code",[t._v("php vendor/bin/dep\n")])])]),a("blockquote",[a("p",[t._v("如果您使用这两种方法安装了Deployer，则运行命令将更喜欢 composer 安装的版本。"),a("code",[t._v("dep")])])]),t._v(" "),a("blockquote",[a("p",[t._v('如果您有依赖冲突，您可以使用"分布  Composer 安装"')])]),t._v(" "),a("h3",{attrs:{id:"分布-composer-安装"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#分布-composer-安装"}},[t._v("#")]),t._v(" 分布 Composer 安装")]),t._v(" "),a("p",[t._v("要用 Composer 安装 Deployer 分布 版本，运行命令：")]),t._v(" "),a("div",{staticClass:"language-sh extra-class"},[a("pre",{pre:!0,attrs:{class:"language-sh"}},[a("code",[t._v("composer require deployer/dist --dev\n")])])]),a("p",[t._v("然后要使用 Deployer，请运行以下命令：")]),t._v(" "),a("div",{staticClass:"language-sh extra-class"},[a("pre",{pre:!0,attrs:{class:"language-sh"}},[a("code",[t._v("php vendor/bin/dep\n")])])]),a("h3",{attrs:{id:"laradock-安装"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#laradock-安装"}},[t._v("#")]),t._v(" Laradock 安装")]),t._v(" "),a("ol",[a("li",[a("p",[t._v("打开 "),a("code",[t._v(".env")]),t._v(" 文件")])]),t._v(" "),a("li",[a("p",[t._v("搜索 "),a("code",[t._v("WORKSPACE_INSTALL_DEPLOYER")])])]),t._v(" "),a("li",[a("p",[t._v("将其设置为true")]),t._v(" "),a("div",{staticClass:"language-yaml extra-class"},[a("pre",{pre:!0,attrs:{class:"language-yaml"}},[a("code",[t._v("WORKSPACE_INSTALL_DEPLOYER=true\n")])])])]),t._v(" "),a("li",[a("p",[t._v("重新构建这个容器"),a("code",[t._v("docker-compose build workspace")])])])]),t._v(" "),a("h3",{attrs:{id:"打包-phar"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#打包-phar"}},[t._v("#")]),t._v(" 打包 phar")]),t._v(" "),a("p",[t._v("如果您想从源代码构建部署程序，则从 GitHub 克隆项目：")]),t._v(" "),a("div",{staticClass:"language-bash extra-class"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[a("span",{pre:!0,attrs:{class:"token function"}},[t._v("git")]),t._v(" clone https://github.com/deployphp/deployer.git\n")])])]),a("p",[t._v("然后在项目目录中运行以下命令：")]),t._v(" "),a("div",{staticClass:"language-bash extra-class"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[t._v("php bin/build\n")])])]),a("p",[t._v("这将构建 phar 存档。"),a("code",[t._v("deployer.phar")])]),t._v(" "),a("h3",{attrs:{id:"自动完成"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#自动完成"}},[t._v("#")]),t._v(" 自动完成")]),t._v(" "),a("p",[t._v("部署器附带了 bash/zsh/fish 的自动完成脚本，因此您不需要记住所有任务和选项。要安装，运行以下命令：")]),t._v(" "),a("div",{staticClass:"language-bash extra-class"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[t._v("dep autocomplete\n")])])]),a("p",[t._v("并按照说明操作。")]),t._v(" "),a("h3",{attrs:{id:"安装完成"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#安装完成"}},[t._v("#")]),t._v(" 安装完成")]),t._v(" "),a("div",{staticClass:"language-php extra-class"},[a("pre",{pre:!0,attrs:{class:"language-php"}},[a("code",[t._v("dep\n")])])]),a("p",[a("img",{attrs:{src:"https://i.loli.net/2021/04/26/4GfkMxNJRhBd561.png",alt:"image-20210426151139721"}})]),t._v(" "),a("p",[t._v("可以看到有正常的输出，说明安装成功。")]),t._v(" "),a("h2",{attrs:{id:"配置脚本"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#配置脚本"}},[t._v("#")]),t._v(" 配置脚本")]),t._v(" "),a("h3",{attrs:{id:"创建部署脚本"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#创建部署脚本"}},[t._v("#")]),t._v(" 创建部署脚本")]),t._v(" "),a("p",[t._v("现在我们需要创建一个目录用于放置部署脚本：")]),t._v(" "),a("div",{staticClass:"language-php extra-class"},[a("pre",{pre:!0,attrs:{class:"language-php"}},[a("code",[t._v("$ mkdir "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("p "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("~")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("code"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("deploy\n$ cd "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("~")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("code"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("deploy"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("laravel\n$ dep init\n")])])]),a("p",[a("code",[t._v("dep init")]),t._v(" 命令用来创建一个部署脚本，会询问我们项目类型，我们是 Laravel 项目所以输入 "),a("code",[t._v("1")]),t._v(" 然后回车；接下来询问 "),a("code",[t._v("Repository")]),t._v(" 也就是我们代码仓库的地址，大家填入自己的 github 仓库地址即可：")]),t._v(" "),a("blockquote",[a("p",[t._v("注意：这里要填 Https 形式的 Github 仓库地址，因为 SSH 格式的地址需要服务器有 Deploy Key 才可以正常访问。")])]),t._v(" "),a("p",[a("a",{attrs:{href:"https://cdn.learnku.com/uploads/images/201901/05/5320/sNoYb7d4U8.png!large",target:"_blank",rel:"noopener noreferrer"}},[a("img",{attrs:{src:"https://cdn.learnku.com/uploads/images/201901/05/5320/sNoYb7d4U8.png!large",alt:"file"}}),a("OutboundLink")],1)]),t._v(" "),a("p",[t._v("接下来会询问是否允许 Deployer 收集匿名的部署数据以改善项目，大家根据自己的情况填入 "),a("code",[t._v("yes")]),t._v(" 或者 "),a("code",[t._v("no")]),t._v("：")]),t._v(" "),a("p",[a("a",{attrs:{href:"https://cdn.learnku.com/uploads/images/201808/25/5320/9KYgJzfd8r.png?imageView2/2/w/1240/h/0",target:"_blank",rel:"noopener noreferrer"}},[a("img",{attrs:{src:"https://cdn.learnku.com/uploads/images/201808/25/5320/9KYgJzfd8r.png?imageView2/2/w/1240/h/0",alt:"file"}}),a("OutboundLink")],1)]),t._v(" "),a("p",[t._v("可以看到 Deployer 在当前目录下创建了一个名为 "),a("code",[t._v("deploy.php")]),t._v(" 的文件。")]),t._v(" "),a("p",[t._v("我们现在来看看这个文件里有哪些东西：")]),t._v(" "),a("div",{staticClass:"language-php extra-class"},[a("pre",{pre:!0,attrs:{class:"language-php"}},[a("code",[a("span",{pre:!0,attrs:{class:"token php language-php"}},[a("span",{pre:!0,attrs:{class:"token delimiter important"}},[t._v("<?php")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("namespace")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token package"}},[t._v("Deployer")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 引入官方的 Laravel 部署脚本")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("require")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token single-quoted-string string"}},[t._v("'recipe/laravel.php'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 设置一个名为 application 的环境变量，值为 my_project")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("set")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token single-quoted-string string"}},[t._v("'application'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token single-quoted-string string"}},[t._v("'my_project'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 设置一个名为 repository，值为初始化脚本时输入的 github 仓库地址")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("set")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token single-quoted-string string"}},[t._v("'repository'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token single-quoted-string string"}},[t._v("'https://github.com/leo108/laravel-shop-advanced-57.git'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 设置环境变量，不需要关心")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("set")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token single-quoted-string string"}},[t._v("'git_tty'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token boolean constant"}},[t._v("true")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// shared_files / shared_dirs 这两个环境变量是数组格式，add 函数可以往数组里添加值")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("add")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token single-quoted-string string"}},[t._v("'shared_files'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("add")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token single-quoted-string string"}},[t._v("'shared_dirs'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// Deployer 会把这个变量下的目录加上写权限")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("add")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token single-quoted-string string"}},[t._v("'writable_dirs'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 添加一台服务器，服务器 IP/域名 是 project.com")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("host")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token single-quoted-string string"}},[t._v("'project.com'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 设置一个这台服务器独享的环境变量，名为 deploy_path，值为 ~/my_project")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// Deployer 会把花括号包裹起来的字符串替换成对应的环境变量")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("set")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token single-quoted-string string"}},[t._v("'deploy_path'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token single-quoted-string string"}},[t._v("'~/{{application}}'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 定义一个名为 build 的任务")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("task")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token single-quoted-string string"}},[t._v("'build'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("function")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 这个任务的内容是执行 cd ~/my_project && build 命令")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("run")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token single-quoted-string string"}},[t._v("'cd {{release_path}} && build'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 定义一个后置钩子，当 deploy:failed 任务被执行之后，Deployer 会执行 deploy:unlock 任务")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("after")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token single-quoted-string string"}},[t._v("'deploy:failed'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token single-quoted-string string"}},[t._v("'deploy:unlock'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 定义一个前置钩子，在执行 deploy:symlink 任务之前先执行 artisan:migrate")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("before")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token single-quoted-string string"}},[t._v("'deploy:symlink'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token single-quoted-string string"}},[t._v("'artisan:migrate'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n")])])])]),a("p",[t._v("可以看到在这个部署文件里并没有太多涉及到部署逻辑的地方，这是因为大部分的部署逻辑都在 "),a("code",[t._v("recipe/laravel.php")]),t._v(" 这个 Deployer 自带的脚本中写好了，我们来看看这个文件的内容，这个文件在本地的路径是 "),a("code",[t._v("~/.composer/vendor/deployer/deployer/recipe/laravel.php")]),t._v("，我们也可以在 github 上直接查看 "),a("a",{attrs:{href:"https://github.com/deployphp/deployer/blob/master/recipe/laravel.php",target:"_blank",rel:"noopener noreferrer"}},[t._v("github.com/deployphp/deployer/blob..."),a("OutboundLink")],1),t._v(" 。")]),t._v(" "),a("p",[t._v("这里面大部分内容都比较浅显易懂，这里就不一一解释了。")]),t._v(" "),a("p",[t._v("我们查看一下这个文件的最底部，可以看到定义了一个名为 "),a("code",[t._v("deploy")]),t._v(" 任务，这个是 Deployer 中的默认任务，当我们使用 Deployer 部署而又没有指定具体的任务时，Deployer 就会默认执行 "),a("code",[t._v("deploy")]),t._v(" 任务。")]),t._v(" "),a("p",[t._v("这个 "),a("code",[t._v("deploy")]),t._v(" 任务的内容是一个数组，这代表 "),a("code",[t._v("deploy")]),t._v(" 是一个任务组，Deployer 会按照数组中的顺序依次执行任务。")]),t._v(" "),a("h2",{attrs:{id:"开始使用"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#开始使用"}},[t._v("#")]),t._v(" 开始使用")]),t._v(" "),a("h3",{attrs:{id:"部署"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#部署"}},[t._v("#")]),t._v(" 部署")]),t._v(" "),a("p",[t._v("阅读有关"),a("a",{attrs:{href:"https://deployer.org/docs/configuration.html",target:"_blank",rel:"noopener noreferrer"}},[t._v("配置部署"),a("OutboundLink")],1),t._v("的有关内容。")]),t._v(" "),a("p",[t._v("现在，让我们部署我们的应用程序：")]),t._v(" "),a("div",{staticClass:"language-sh extra-class"},[a("pre",{pre:!0,attrs:{class:"language-sh"}},[a("code",[t._v("dep deploy\n")])])]),a("p",[t._v("若要在输出中包含额外的详细信息，可以使用以下选项增加详细程度："),a("code",[t._v("--verbose")])]),t._v(" "),a("ul",[a("li",[a("code",[t._v("-v")]),t._v("对于正常输出，")]),t._v(" "),a("li",[a("code",[t._v("-vv")]),t._v("要进行更详细的输出，")]),t._v(" "),a("li",[a("code",[t._v("-vvv")]),t._v("用于调试。")])]),t._v(" "),a("p",[t._v("部署器将在主机上创建以下目录：")]),t._v(" "),a("ul",[a("li",[a("code",[t._v("releases")]),t._v("包含发布 dirs，")]),t._v(" "),a("li",[a("code",[t._v("shared")]),t._v("包含共享文件和 dirs，")]),t._v(" "),a("li",[a("code",[t._v("current")]),t._v("符号链接到当前版本")]),t._v(" "),a("li",[t._v("配置主机以从 "),a("code",[t._v("current")]),t._v(" 中为公共目录服务。")])]),t._v(" "),a("p",[t._v("默认情况下，部署程序保留最后 5 个版本，但您可以通过修改关联的参数来增加此数量：")]),t._v(" "),a("div",{staticClass:"language-php extra-class"},[a("pre",{pre:!0,attrs:{class:"language-php"}},[a("code",[a("span",{pre:!0,attrs:{class:"token function"}},[t._v("set")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token single-quoted-string string"}},[t._v("'keep_releases'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("10")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n")])])]),a("h3",{attrs:{id:"回滚代码"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#回滚代码"}},[t._v("#")]),t._v(" 回滚代码")]),t._v(" "),a("p",[t._v("如果部署过程中出现错误或新版本出现问题，只需运行以下命令即可回滚到以前的工作版本：")]),t._v(" "),a("div",{staticClass:"language-sh extra-class"},[a("pre",{pre:!0,attrs:{class:"language-sh"}},[a("code",[t._v("dep rollback\n")])])])])}),[],!1,null,null,null);s.default=r.exports}}]);